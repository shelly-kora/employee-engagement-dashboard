<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心动员工敬业度调研数据</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #0078d4;
            --success: #107c10;
            --warning: #ff8c00;
            --danger: #d13438;
            --info: #0078d4;
            --light: #f8f9fa;
            --dark: #323130;
            --surface: #ffffff;
            --border: #e1dfdd;
            --text-primary: #323130;
            --text-secondary: #605e5c;
            --green: #107c10;
            --orange: #ff8c00;
            --red: #d13438;
            --blue: #0078d4;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--light);
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            font-size: 24px;
            color: var(--primary);
        }
        
        .title-group h1 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        
        .title-group .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        .actions {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .btn-outline {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .kpi-card {
            background: var(--surface);
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
            transition: transform 0.2s;
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
        }
        
        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .kpi-title {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .kpi-icon {
            font-size: 24px;
            opacity: 0.7;
        }
        
        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .kpi-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }
        
        .trend-up {
            color: var(--green);
        }
        
        .trend-down {
            color: var(--red);
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .chart-card {
            background: var(--surface);
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .chart-container {
            height: 320px;
            position: relative;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab:hover:not(.active) {
            color: var(--text-primary);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .data-table th {
            background: var(--light);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
        }
        
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .data-table tr:hover {
            background: var(--light);
        }
        
        .department-table tr.expandable {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .department-table tr.expandable:hover {
            background: rgba(0, 120, 212, 0.05);
        }
        
        .department-table tr.expandable td:first-child::before {
            content: '▶';
            margin-right: 8px;
            transition: transform 0.2s;
            display: inline-block;
        }
        
        .department-table tr.expandable.expanded td:first-child::before {
            transform: rotate(90deg);
        }
        
        .department-table tr.sub-department {
            background: rgba(0, 120, 212, 0.02);
            display: none;
        }
        
        .department-table tr.sub-department.show {
            display: table-row;
        }
        
        .department-table tr.sub-department td:first-child {
            padding-left: 40px;
            border-left: 3px solid var(--primary);
            position: relative;
        }
        
        .department-table tr.sub-department td:first-child::before {
            content: '└';
            position: absolute;
            left: 20px;
            color: var(--text-secondary);
        }
        
        .metric-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-excellent {
            background: rgba(16, 124, 16, 0.1);
            color: var(--green);
        }
        
        .badge-good {
            background: rgba(0, 120, 212, 0.1);
            color: var(--blue);
        }
        
        .badge-average {
            background: rgba(255, 140, 0, 0.1);
            color: var(--orange);
        }
        
        .badge-poor {
            background: rgba(209, 52, 56, 0.1);
            color: var(--red);
        }
        
        .department-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        
        .department-card {
            background: var(--surface);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border);
        }
        
        .department-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }
        
        .department-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .metric {
            text-align: center;
        }
        
        .metric-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        .hidden {
            display: none;
        }
        
        .chatbot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: var(--surface);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            z-index: 1000;
        }
        
        .chatbot-header {
            padding: 16px;
            background: var(--primary);
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }
        
        .message {
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 12px;
            max-width: 80%;
        }
        
        .message.user {
            background: var(--primary);
            color: white;
            margin-left: auto;
        }
        
        .message.bot {
            background: var(--light);
            color: var(--text-primary);
        }
        
        .chatbot-input {
            padding: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 20px;
            outline: none;
        }
        
        .chatbot-input button {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-section">
            <div class="logo">📊</div>
            <div class="title-group">
                <h1>心动员工敬业度调研数据</h1>
                <div class="subtitle">2024年度分析报告</div>
            </div>
        </div>
        <div class="actions">
            <input type="file" id="excel-file" style="display: none;" accept=".xlsx,.xls" />
            <button class="btn btn-outline" onclick="document.getElementById('excel-file').click()">
                <span>📤</span> 上传数据
            </button>
            <button class="btn btn-primary" onclick="toggleChatbot()">
                <span>💬</span> 智能问答
            </button>
        </div>
    </div>

    <div class="container">
        <!-- KPI 仪表板 -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">总体人数</div>
                    <div class="kpi-icon">👥</div>
                </div>
                <div class="kpi-value">1,284</div>
                <div class="kpi-change">
                    <span>员工总数</span>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">填写人数</div>
                    <div class="kpi-icon">✅</div>
                </div>
                <div class="kpi-value">828</div>
                <div class="kpi-change">
                    <span class="trend-up">▲ 64.5%</span> 填写率
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">2024年敬业度</div>
                    <div class="kpi-icon">🔥</div>
                </div>
                <div class="kpi-value">68%</div>
                <div class="kpi-change">
                    <span class="trend-up">▲ +8%</span> vs 2023年
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">2024年满意度</div>
                    <div class="kpi-icon">😊</div>
                </div>
                <div class="kpi-value">68%</div>
                <div class="kpi-change">
                    <span class="trend-up">▲ +8%</span> vs 2023年
                </div>
            </div>
        </div>

        <!-- 图表网格 -->
        <div class="charts-grid">
            <!-- 敬业度-满意度四象限图 -->
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">员工敬业-满意度交叉分析</div>
                </div>
                <div class="chart-container">
                    <canvas id="quadrantChart"></canvas>
                </div>
            </div>

            <!-- 年度对比图 -->
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">年度对比趋势</div>
                </div>
                <div class="chart-container">
                    <canvas id="yearly-trend"></canvas>
                </div>
            </div>
        </div>

        <!-- 标签页 -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('departments')">全部部门</button>
            <button class="tab" onclick="showTab('subdepartments')">二级部门</button>
            <button class="tab" onclick="showTab('management')">管理层对比</button>
            <button class="tab" onclick="showTab('levels')">职级分析</button>
        </div>

        <!-- 标签页内容 -->
        <div id="departments" class="tab-content active">
            <table class="department-table">
                <thead>
                    <tr>
                        <th style="width: 40%;">部门</th>
                        <th style="width: 12%;">参与人数</th>
                        <th style="width: 16%;">敬业度</th>
                        <th style="width: 16%;">满意度</th>
                        <th style="width: 16%;">高效员工比例</th>
                    </tr>
                </thead>
                <tbody id="departmentTableBody">
                    <!-- 部门数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>

        <div id="subdepartments" class="tab-content">
            <table class="department-table">
                <thead>
                    <tr>
                        <th style="width: 30%;">二级部门</th>
                        <th style="width: 20%;">所属一级部门</th>
                        <th style="width: 12%;">参与人数</th>
                        <th style="width: 13%;">敬业度</th>
                        <th style="width: 13%;">满意度</th>
                        <th style="width: 12%;">高效员工比例</th>
                    </tr>
                </thead>
                <tbody id="subDepartmentTableBody">
                    <!-- 二级部门数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>

        <div id="management" class="tab-content">
            <table class="department-table">
                <thead>
                    <tr>
                        <th>管理岗位</th>
                        <th>填写人数</th>
                        <th>敬业度</th>
                        <th>满意度</th>
                        <th>敬业且满意比例</th>
                    </tr>
                </thead>
                <tbody id="managementTableBody">
                    <!-- 管理岗位数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>

        <div id="levels" class="tab-content">
            <table class="department-table">
                <thead>
                    <tr>
                        <th>职级</th>
                        <th>填写人数</th>
                        <th>敬业度</th>
                        <th>满意度</th>
                        <th>敬业且满意比例</th>
                    </tr>
                </thead>
                <tbody id="levelsTableBody">
                    <!-- 职级数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- 聊天机器人 -->
    <div class="chatbot hidden" id="chatbot">
        <div class="chatbot-header">
            <span>💬 数据助手</span>
            <button class="chatbot-close" onclick="toggleChatbot()">✕</button>
        </div>
        <div class="chatbot-messages" id="chat-messages">
            <div class="message bot">
                您好！我是员工敬业度调研数据助手。您可以询问：<br>
                • 哪个部门表现最好？<br>
                • 敬业度变化趋势如何？<br>
                • 满意度主要问题在哪里？
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chat-input" placeholder="输入您的问题..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button onclick="sendMessage()">发送</button>
        </div>
    </div>

    <script>
        // 全局数据存储
        let surveyData = {
            "填写率": [{"总体人数": 1284, "填写人数": 828, "填写率": 0.645, "对比去年": 0.145}],
            "结论概览": [{"24年敬业度": 0.68, "23年敬业度": 0.6, "24年满意度": 0.68, "23年满意度": 0.6}],
            "按管理岗位": [
                {"岗位类型": "管理岗位", "填写人数": 157, "敬业度": 0.764, "满意度": 0.783, "敬业且满意": 0.694},
                {"岗位类型": "非管理岗位", "填写人数": 671, "敬业度": 0.662, "满意度": 0.654, "敬业且满意": 0.613}
            ],
            "按职级": [
                {"职级类型": "3和4职级", "填写人数": 325, "敬业度": 0.708, "满意度": 0.705, "敬业且满意": 0.652},
                {"职级类型": "1和2职级", "填写人数": 503, "敬业度": 0.664, "满意度": 0.662, "敬业且满意": 0.612}
            ]
        };
        
        let departmentData = [
            // 一级部门数据
            {name: '财务部', count: 10, engagement: 40, satisfaction: 40, efficiency: 0, 
             engagementSatisfied: 0, frustrated: 0, satisfied: 60, inefficient: 40},
            {name: '城北大王寨工作室', count: 172, engagement: 60, satisfaction: 61, efficiency: 55,
             engagementSatisfied: 55, frustrated: 6, satisfied: 6, inefficient: 33},
            {name: '法务部', count: 7, engagement: 71, satisfaction: 86, efficiency: 71,
             engagementSatisfied: 71, frustrated: 0, satisfied: 14, inefficient: 14},
            {name: '海外发行部', count: 3, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: '极心社工作室', count: 59, engagement: 68, satisfaction: 66, efficiency: 64,
             engagementSatisfied: 64, frustrated: 3, satisfied: 2, inefficient: 31},
            {name: '技术支撑部', count: 62, engagement: 69, satisfaction: 66, efficiency: 61,
             engagementSatisfied: 61, frustrated: 8, satisfied: 5, inefficient: 26},
            {name: '美术支撑部', count: 46, engagement: 59, satisfaction: 59, efficiency: 52,
             engagementSatisfied: 52, frustrated: 7, satisfied: 7, inefficient: 35},
            {name: '平台支撑部', count: 20, engagement: 60, satisfaction: 65, efficiency: 55,
             engagementSatisfied: 55, frustrated: 5, satisfied: 10, inefficient: 30},
            {name: '浅水工作室', count: 12, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: '人力资源部', count: 18, engagement: 61, satisfaction: 78, efficiency: 56,
             engagementSatisfied: 56, frustrated: 6, satisfied: 22, inefficient: 17},
            {name: '市场部', count: 30, engagement: 63, satisfaction: 60, efficiency: 57,
             engagementSatisfied: 57, frustrated: 7, satisfied: 3, inefficient: 33},
            {name: '项目管理部', count: 1, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: '音频支撑部', count: 11, engagement: 45, satisfaction: 64, efficiency: 45,
             engagementSatisfied: 45, frustrated: 0, satisfied: 18, inefficient: 36},
            {name: '游戏菌工作室', count: 35, engagement: 66, satisfaction: 57, efficiency: 54,
             engagementSatisfied: 54, frustrated: 11, satisfied: 3, inefficient: 31},
            {name: '员工服务中心', count: 5, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: '运维支撑部', count: 6, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: '运营部', count: 47, engagement: 74, satisfaction: 72, efficiency: 68,
             engagementSatisfied: 68, frustrated: 6, satisfied: 4, inefficient: 21},
            {name: '政策关系与合规支持中心', count: 19, engagement: 89, satisfaction: 89, efficiency: 89,
             engagementSatisfied: 89, frustrated: 0, satisfied: 0, inefficient: 11},
            {name: '执行办公室', count: 4, engagement: 75, satisfaction: 100, efficiency: 75,
             engagementSatisfied: 75, frustrated: 0, satisfied: 25, inefficient: 0},
            {name: 'ADN', count: 7, engagement: 71, satisfaction: 71, efficiency: 71,
             engagementSatisfied: 71, frustrated: 0, satisfied: 0, inefficient: 29},
            {name: 'B格猫工作室', count: 60, engagement: 77, satisfaction: 72, efficiency: 68,
             engagementSatisfied: 68, frustrated: 8, satisfied: 3, inefficient: 20},
            {name: 'Digital & IT', count: 6, engagement: 67, satisfaction: 100, efficiency: 67,
             engagementSatisfied: 67, frustrated: 0, satisfied: 33, inefficient: 0},
            {name: 'Filo', count: 1, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: 'Flash Party', count: 4, engagement: 75, satisfaction: 100, efficiency: 75,
             engagementSatisfied: 75, frustrated: 0, satisfied: 25, inefficient: 0},
            {name: 'PG 发行 & 商务部', count: 15, engagement: 73, satisfaction: 73, efficiency: 73,
             engagementSatisfied: 73, frustrated: 0, satisfied: 0, inefficient: 27},
            {name: 'TapTap', count: 168, engagement: 71, satisfaction: 69, efficiency: 66,
             engagementSatisfied: 66, frustrated: 5, satisfied: 3, inefficient: 26}
        ];

        // 基于CSV数据的二级部门数据
        const subDepartmentData = {
            '城北大王寨工作室': [
                {name: '海盗项目组', count: 60, engagement: Math.round(0.55*100), satisfaction: Math.round(0.6*100), efficiency: Math.round(0.5*100)},
                {name: '横扫千军项目组', count: 2, engagement: Math.round(0.5*100), satisfaction: Math.round(0.5*100), efficiency: Math.round(0.5*100)},
                {name: '其他', count: 2, engagement: Math.round(0.5*100), satisfaction: Math.round(0.5*100), efficiency: Math.round(0.5*100)},
                {name: '伊瑟项目组（Etheria）', count: 53, engagement: Math.round(0.716981132075472*100), satisfaction: Math.round(0.660377358490566*100), efficiency: Math.round(0.622641509433962*100)},
                {name: 'Meka项目组', count: 55, engagement: Math.round(0.563636363636364*100), satisfaction: Math.round(0.581818181818182*100), efficiency: Math.round(0.527272727272727*100)}
            ],
            '极心社工作室': [
                {name: '策划', count: 21, engagement: Math.round(0.857142857142857*100), satisfaction: Math.round(0.80952380952381*100), efficiency: Math.round(0.80952380952381*100)},
                {name: '技术', count: 9, engagement: Math.round(0.555555555555556*100), satisfaction: Math.round(0.555555555555556*100), efficiency: Math.round(0.555555555555556*100)},
                {name: '美术', count: 24, engagement: Math.round(0.583333333333333*100), satisfaction: Math.round(0.583333333333333*100), efficiency: Math.round(0.541666666666667*100)},
                {name: '其他', count: 5, engagement: Math.round(0.6*100), satisfaction: Math.round(0.6*100), efficiency: Math.round(0.6*100)}
            ],
            '技术支撑部': [
                {name: '品控支撑', count: 31, engagement: Math.round(0.71*100), satisfaction: Math.round(0.68*100), efficiency: Math.round(0.61*100)},
                {name: '其他', count: 2, engagement: Math.round(0.5*100), satisfaction: Math.round(0.5*100), efficiency: Math.round(0.5*100)},
                {name: '研发支撑', count: 29, engagement: Math.round(0.69*100), satisfaction: Math.round(0.66*100), efficiency: Math.round(0.62*100)}
            ],
            '美术支撑部': [
                {name: '2D组', count: 5, engagement: Math.round(0.8*100), satisfaction: Math.round(0.6*100), efficiency: Math.round(0.6*100)},
                {name: '3D组', count: 9, engagement: Math.round(0.777777777777778*100), satisfaction: Math.round(0.888888888888889*100), efficiency: Math.round(0.777777777777778*100)},
                {name: '美宣组', count: 3, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: '其他', count: 6, engagement: Math.round(0.833333333333333*100), satisfaction: Math.round(0.833333333333333*100), efficiency: Math.round(0.833333333333333*100)},
                {name: '影视创意组', count: 7, engagement: Math.round(0.714285714285714*100), satisfaction: Math.round(0.571428571428571*100), efficiency: Math.round(0.571428571428571*100)},
                {name: 'UI组', count: 16, engagement: Math.round(0.1875*100), satisfaction: Math.round(0.25*100), efficiency: Math.round(0.125*100)}
            ],
            '平台支撑部': [
                {name: '技术', count: 8, engagement: Math.round(0.5*100), satisfaction: Math.round(0.625*100), efficiency: Math.round(0.5*100)},
                {name: '其他', count: 3, engagement: Math.round(0.666666666666667*100), satisfaction: Math.round(0.666666666666667*100), efficiency: Math.round(0.666666666666667*100)},
                {name: 'TapDB', count: 7, engagement: Math.round(0.571428571428571*100), satisfaction: Math.round(0.571428571428571*100), efficiency: Math.round(0.428571428571429*100)},
                {name: 'XDWeb', count: 2, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)}
            ],
            '浅水工作室': [
                {name: '其他', count: 6, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: '神仙道', count: 6, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)}
            ],
            '人力资源部': [
                {name: '其他', count: 8, engagement: Math.round(0.375*100), satisfaction: Math.round(0.625*100), efficiency: Math.round(0.25*100)},
                {name: '人才引进', count: 5, engagement: Math.round(0.8*100), satisfaction: Math.round(0.8*100), efficiency: Math.round(0.8*100)},
                {name: 'HRBP', count: 5, engagement: Math.round(0.8*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(0.8*100)}
            ],
            '市场部': [
                {name: '国内投放', count: 6, engagement: Math.round(0.833333333333333*100), satisfaction: Math.round(0.833333333333333*100), efficiency: Math.round(0.833333333333333*100)},
                {name: '媒介公关', count: 4, engagement: Math.round(0.5*100), satisfaction: Math.round(0.25*100), efficiency: Math.round(0.25*100)},
                {name: '其他', count: 1, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: '市场营销', count: 6, engagement: Math.round(0.833333333333333*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(0.833333333333333*100)},
                {name: '视觉创意', count: 13, engagement: Math.round(0.461538461538462*100), satisfaction: Math.round(0.384615384615385*100), efficiency: Math.round(0.384615384615385*100)}
            ],
            '音频支撑部': [
                {name: '其他', count: 3, engagement: Math.round(0.333333333333333*100), satisfaction: Math.round(0.666666666666667*100), efficiency: Math.round(0.333333333333333*100)},
                {name: '音频设计组', count: 8, engagement: Math.round(0.5*100), satisfaction: Math.round(0.625*100), efficiency: Math.round(0.5*100)}
            ],
            '游戏菌工作室': [
                {name: '策划', count: 7, engagement: Math.round(0.714285714285714*100), satisfaction: Math.round(0.428571428571429*100), efficiency: Math.round(0.428571428571429*100)},
                {name: '程序', count: 16, engagement: Math.round(0.625*100), satisfaction: Math.round(0.5625*100), efficiency: Math.round(0.5*100)},
                {name: '美术', count: 9, engagement: Math.round(0.666666666666667*100), satisfaction: Math.round(0.666666666666667*100), efficiency: Math.round(0.555555555555556*100)},
                {name: '其他', count: 3, engagement: Math.round(1.0*100), satisfaction: Math.round(0.666666666666667*100), efficiency: Math.round(0.666666666666667*100)}
            ],
            '员工服务中心': [
                {name: '后勤保障中心', count: 2, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: '其他', count: 3, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)}
            ],
            '运营部': [
                {name: '海外发行支持', count: 6, engagement: Math.round(0.666666666666667*100), satisfaction: Math.round(0.5*100), efficiency: Math.round(0.5*100)},
                {name: '火炬之光', count: 4, engagement: Math.round(0.75*100), satisfaction: Math.round(0.75*100), efficiency: Math.round(0.75*100)},
                {name: '铃兰之剑', count: 3, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: '麦芬', count: 3, engagement: Math.round(0.666666666666667*100), satisfaction: Math.round(0.666666666666667*100), efficiency: Math.round(0.666666666666667*100)},
                {name: '其他', count: 1, engagement: Math.round(0.0*100), satisfaction: Math.round(0.0*100), efficiency: Math.round(0.0*100)},
                {name: '香肠派对', count: 6, engagement: Math.round(1.0*100), satisfaction: Math.round(0.833333333333333*100), efficiency: Math.round(0.833333333333333*100)},
                {name: '心动小镇', count: 4, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: '伊瑟', count: 3, engagement: Math.round(0.333333333333333*100), satisfaction: Math.round(0.333333333333333*100), efficiency: Math.round(0.333333333333333*100)},
                {name: '运营基建支持', count: 2, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: '长尾项目', count: 7, engagement: Math.round(1.0*100), satisfaction: Math.round(0.857142857142857*100), efficiency: Math.round(0.857142857142857*100)},
                {name: 'RO', count: 8, engagement: Math.round(0.375*100), satisfaction: Math.round(0.625*100), efficiency: Math.round(0.375*100)}
            ],
            '政策关系与合规支持中心': [
                {name: '公共关系', count: 6, engagement: Math.round(0.833333333333333*100), satisfaction: Math.round(0.833333333333333*100), efficiency: Math.round(0.833333333333333*100)},
                {name: '内容风控', count: 13, engagement: Math.round(0.923076923076923*100), satisfaction: Math.round(0.923076923076923*100), efficiency: Math.round(0.923076923076923*100)}
            ],
            '执行办公室': [
                {name: '财务审计组', count: 3, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: '其他', count: 1, engagement: Math.round(0.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(0.0*100)}
            ],
            'B格猫工作室': [
                {name: 'RO项目组', count: 58, engagement: Math.round(0.775862068965517*100), satisfaction: Math.round(0.724137931034483*100), efficiency: Math.round(0.672413793103448*100)}
            ],
            'Digital & IT': [
                {name: '其他', count: 1, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: 'Infrastructure', count: 2, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: 'OA Dev', count: 1, engagement: Math.round(0.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(0.0*100)},
                {name: 'Operation', count: 2, engagement: Math.round(0.5*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(0.5*100)}
            ],
            'Flash Party': [
                {name: '技术', count: 2, engagement: Math.round(0.5*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(0.5*100)},
                {name: '其他', count: 2, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)}
            ],
            'PG 发行 & 商务部': [
                {name: '海外发行', count: 3, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: '其他', count: 6, engagement: Math.round(0.5*100), satisfaction: Math.round(0.5*100), efficiency: Math.round(0.5*100)},
                {name: '市场推广', count: 2, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: '游戏发行业务', count: 4, engagement: Math.round(0.75*100), satisfaction: Math.round(0.75*100), efficiency: Math.round(0.75*100)}
            ],
            'TapTap': [
                {name: 'Contents', count: 1, engagement: Math.round(1.0*100), satisfaction: Math.round(1.0*100), efficiency: Math.round(1.0*100)},
                {name: 'Core Product & Services', count: 46, engagement: Math.round(0.652173913043478*100), satisfaction: Math.round(0.608695652173913*100), efficiency: Math.round(0.58695652173913*100)},
                {name: 'Design Team', count: 10, engagement: Math.round(0.7*100), satisfaction: Math.round(0.6*100), efficiency: Math.round(0.6*100)},
                {name: 'Developer Ops', count: 9, engagement: Math.round(0.888888888888889*100), satisfaction: Math.round(0.777777777777778*100), efficiency: Math.round(0.777777777777778*100)},
                {name: 'Editors', count: 11, engagement: Math.round(0.909090909090909*100), satisfaction: Math.round(0.909090909090909*100), efficiency: Math.round(0.909090909090909*100)},
                {name: 'IEM', count: 31, engagement: Math.round(0.741935483870968*100), satisfaction: Math.round(0.741935483870968*100), efficiency: Math.round(0.709677419354839*100)},
                {name: 'International', count: 3, engagement: Math.round(0.0*100), satisfaction: Math.round(0.0*100), efficiency: Math.round(0.0*100)},
                {name: 'Ops', count: 19, engagement: Math.round(0.842105263157895*100), satisfaction: Math.round(0.842105263157895*100), efficiency: Math.round(0.842105263157895*100)},
                {name: 'Project SCE', count: 8, engagement: Math.round(0.625*100), satisfaction: Math.round(0.625*100), efficiency: Math.round(0.625*100)},
                {name: 'Store', count: 11, engagement: Math.round(0.363636363636364*100), satisfaction: Math.round(0.545454545454545*100), efficiency: Math.round(0.363636363636364*100)},
                {name: 'UG', count: 18, engagement: Math.round(0.833333333333333*100), satisfaction: Math.round(0.777777777777778*100), efficiency: Math.round(0.722222222222222*100)}
            ]
        };

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            createCharts();
        });
        
        function loadDashboard() {
            // KPI数据已在HTML中硬编码，这里可以添加动态更新逻辑
        }
        
        function createCharts() {
            createQuadrantChart();
            createYearlyTrendChart();
        }
        
        function createQuadrantChart() {
            const ctx = document.getElementById('quadrantChart').getContext('2d');
            
            // 员工分类数据 - 根据图片中的数据
            const employeeData = [
                {
                    label: '高效员工 (敬业且满意)',
                    x: 78,  // 满意度
                    y: 78,  // 敬业度
                    r: 25,  // 62.8%对应的大圆
                    backgroundColor: 'rgba(40, 167, 69, 0.7)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    percentage: '62.8%'
                },
                {
                    label: '受挫员工 (敬业不满意)',
                    x: 25,  // 满意度
                    y: 75,  // 敬业度
                    r: 8,   // 5.3%对应的小圆
                    backgroundColor: 'rgba(255, 193, 7, 0.7)',
                    borderColor: 'rgba(255, 193, 7, 1)',
                    percentage: '5.3%'
                },
                {
                    label: '漠然员工 (不敬业但满意)',
                    x: 75,  // 满意度
                    y: 25,  // 敬业度
                    r: 8,   // 5.1%对应的小圆
                    backgroundColor: 'rgba(0, 123, 255, 0.7)',
                    borderColor: 'rgba(0, 123, 255, 1)',
                    percentage: '5.1%'
                },
                {
                    label: '低效员工 (不敬业不满意)',
                    x: 25,  // 满意度
                    y: 22,  // 敬业度
                    r: 15,  // 26.8%对应的中圆
                    backgroundColor: 'rgba(220, 53, 69, 0.7)',
                    borderColor: 'rgba(220, 53, 69, 1)',
                    percentage: '26.8%'
                }
            ];

            new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: employeeData.map(item => ({
                        label: item.label,
                        data: [{
                            x: item.x,
                            y: item.y,
                            r: item.r
                        }],
                        backgroundColor: item.backgroundColor,
                        borderColor: item.borderColor,
                        borderWidth: 2,
                        percentage: item.percentage
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                generateLabels: function(chart) {
                                    return employeeData.map((item, index) => ({
                                        text: `${item.label.split(' ')[0]} ${item.percentage}`,
                                        fillStyle: item.backgroundColor,
                                        strokeStyle: item.borderColor,
                                        lineWidth: 2,
                                        pointStyle: 'circle'
                                    }));
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function() {
                                    return '';
                                },
                                label: function(context) {
                                    const dataset = context.dataset;
                                    const dataPoint = context.parsed;
                                    return [
                                        `${dataset.label}`,
                                        `比例: ${dataset.percentage}`,
                                        `满意度: ${dataPoint.x}%`,
                                        `敬业度: ${dataPoint.y}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: '满意度 (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                stepSize: 25,
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: '敬业度 (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                stepSize: 25,
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false
                    }
                }
            });
        }
        
        function createYearlyTrendChart() {
            const ctx = document.getElementById('yearly-trend').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2023年', '2024年'],
                    datasets: [
                        {
                            label: '敬业度',
                            data: [60, 68],
                            borderColor: '#0078d4',
                            backgroundColor: 'rgba(0, 120, 212, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: '满意度',
                            data: [60, 68],
                            borderColor: '#107c10',
                            backgroundColor: 'rgba(16, 124, 16, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: value => value + '%' }
                        }
                    },
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
        }
        
        function getScoreColor(score) {
            if (score >= 80) return '#107c10';
            if (score >= 60) return '#0078d4';
            if (score >= 40) return '#ff8c00';
            return '#d13438';
        }
        
        // 标签页切换
        function showTab(tabName) {
            // 隐藏所有标签页内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 移除所有标签页的活动状态
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 显示选中的标签页内容
            document.getElementById(tabName).classList.add('active');
            
            // 激活选中的标签页
            event.target.classList.add('active');
            
            // 根据标签页类型更新表格数据
            if (tabName === 'departments') {
                generateDepartmentTable();
            } else if (tabName === 'subdepartments') {
                generateSubDepartmentTable();
            } else if (tabName === 'management') {
                generateManagementTable();
            } else if (tabName === 'levels') {
                generateLevelsTable();
            }
        }

        function generateDepartmentTable() {
            const tbody = document.getElementById('departmentTableBody');
            tbody.innerHTML = '';
            
            departmentData.forEach((dept, index) => {
                // 一级部门行
                const row = document.createElement('tr');
                const hasSubDepts = subDepartmentData[dept.name] && subDepartmentData[dept.name].length > 0;
                
                if (hasSubDepts) {
                    row.className = 'expandable';
                    row.onclick = () => toggleSubDepartments(index);
                }
                
                row.innerHTML = `
                    <td><strong>${dept.name}</strong></td>
                    <td>${dept.count}</td>
                    <td>${getBadge(dept.engagement)}</td>
                    <td>${getBadge(dept.satisfaction)}</td>
                    <td>${getBadge(dept.efficiency)}</td>
                `;
                tbody.appendChild(row);
                
                // 二级部门行
                if (hasSubDepts) {
                    subDepartmentData[dept.name].forEach(subDept => {
                        const subRow = document.createElement('tr');
                        subRow.className = `sub-department sub-${index}`;
                        subRow.innerHTML = `
                            <td>${subDept.name}</td>
                            <td>${dept.name}</td>
                            <td>${subDept.count}</td>
                            <td>${getBadge(subDept.engagement)}</td>
                            <td>${getBadge(subDept.satisfaction)}</td>
                            <td>${getBadge(subDept.efficiency)}</td>
                        `;
                        tbody.appendChild(subRow);
                    });
                }
            });
        }

        function toggleSubDepartments(index) {
            const parentRow = document.querySelector(`tr.expandable:nth-of-type(${index + 1})`);
            const subRows = document.querySelectorAll(`.sub-${index}`);
            
            if (parentRow.classList.contains('expanded')) {
                parentRow.classList.remove('expanded');
                subRows.forEach(row => row.classList.remove('show'));
            } else {
                parentRow.classList.add('expanded');
                subRows.forEach(row => row.classList.add('show'));
            }
        }

        function getBadge(value) {
            const percentage = Math.round(typeof value === 'number' ? value : value * 100);
            let badgeClass = 'badge-poor';
            
            if (percentage >= 80) badgeClass = 'badge-excellent';
            else if (percentage >= 60) badgeClass = 'badge-good';
            else if (percentage >= 40) badgeClass = 'badge-average';
            
            return `<span class="metric-badge ${badgeClass}">${percentage}%</span>`;
        }

        function generateSubDepartmentTable() {
            const tbody = document.getElementById('subDepartmentTableBody');
            tbody.innerHTML = '';
            
            departmentData.forEach((dept, index) => {
                if (subDepartmentData[dept.name]) {
                    subDepartmentData[dept.name].forEach((subDept, subIndex) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${subDept.name}</td>
                            <td>${dept.name}</td>
                            <td>${subDept.count}</td>
                            <td>${getBadge(subDept.engagement)}</td>
                            <td>${getBadge(subDept.satisfaction)}</td>
                            <td>${getBadge(subDept.efficiency)}</td>
                        `;
                        tbody.appendChild(row);
                    });
                }
            });
        }

        function generateManagementTable() {
            const tbody = document.getElementById('managementTableBody');
            tbody.innerHTML = '';
            
            const managementData = surveyData['按管理岗位'];
            managementData.forEach(dept => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dept.岗位类型}</td>
                    <td>${dept.填写人数}</td>
                    <td>${getBadge(dept.敬业度)}</td>
                    <td>${getBadge(dept.满意度)}</td>
                    <td>${getBadge(Math.round(dept.敬业且满意))}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function generateLevelsTable() {
            const tbody = document.getElementById('levelsTableBody');
            tbody.innerHTML = '';
            
            const levelsData = surveyData['按职级'];
            levelsData.forEach(dept => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dept.职级类型}</td>
                    <td>${dept.填写人数}</td>
                    <td>${getBadge(dept.敬业度)}</td>
                    <td>${getBadge(dept.满意度)}</td>
                    <td>${getBadge(Math.round(dept.敬业且满意))}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function toggleChatbot() {
            const chatbot = document.getElementById('chatbot');
            chatbot.classList.toggle('hidden');
        }
        
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            
            const messages = document.getElementById('chat-messages');
            
            // 添加用户消息
            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.textContent = message;
            messages.appendChild(userMsg);
            
            // 生成机器人回复
            setTimeout(() => {
                const botMsg = document.createElement('div');
                botMsg.className = 'message bot';
                botMsg.textContent = generateResponse(message);
                messages.appendChild(botMsg);
                messages.scrollTop = messages.scrollHeight;
            }, 500);
            
            input.value = '';
            messages.scrollTop = messages.scrollHeight;
        }
        
        function generateResponse(message) {
            const responses = {
                '敬业度': '2024年整体敬业度为68%，相比2023年的60%有显著提升。管理岗位敬业度(76.4%)明显高于非管理岗位(66.2%)。',
                '满意度': '2024年整体满意度为68%，同比提升8个百分点。TapTap部门表现突出，满意度达到70%以上。',
                '部门': 'TapTap部门表现最佳，敬业度和满意度均在70%以上。财务部需要重点关注，各项指标偏低。',
                '建议': '建议重点关注：1.加强非管理岗位的职业发展规划 2.提升财务部门的工作环境 3.推广TapTap的优秀管理经验',
                '默认': '感谢您的提问！您可以询问关于敬业度、满意度、部门表现或改进建议等方面的问题。'
            };
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !isAIResponding) {
                sendMessage();
            }
        }

        function closeChatbot() {
            console.log('Closing chatbot...');
            const chatbot = document.getElementById('chatbot');
            if (chatbot) {
                chatbot.classList.add('hidden');
                console.log('Chatbot hidden');
            } else {
                console.error('Chatbot element not found');
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initSatisfactionAnalysis();
            generateDepartmentTable();
            createQuadrantChart();
            createTrendChart();
        });

        // 更新问题列表
        function updateQuestionsList(department) {
            const questionsList = document.getElementById('questionsList');
            const scores = departmentSatisfactionData[department] || departmentSatisfactionData['overall'];
            
            // 问题标签 - 对应雷达图的标签
            const questionLabels = [
                '工作', '文化', '高管', '成长', '中层', '反馈', '汰换', '协作', 
                '学习', '成就', '平衡', '沟通', '流程', '目标', '声誉', '薪酬', 
                '认可', '资源', '福利', '上级', '架构', '绩效'
            ];
            
            questionsList.innerHTML = '';
            
            satisfactionQuestions.forEach((question, index) => {
                const score = Math.round(scores[index]);
                const questionItem = document.createElement('div');
                questionItem.className = 'question-item';
                
                questionItem.innerHTML = `
                    <div class="question-number">${questionLabels[index]}</div>
                    <div class="question-text">${question}</div>
                    <div class="question-score">${score}%</div>
                `;
                
                questionsList.appendChild(questionItem);
            });
        }
    </script>
</body>
</html> 