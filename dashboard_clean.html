<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心动员工敬业度调研数据</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #0078d4;
            --success: #107c10;
            --warning: #ff8c00;
            --danger: #d13438;
            --info: #0078d4;
            --light: #f8f9fa;
            --dark: #323130;
            --surface: #ffffff;
            --border: #e1dfdd;
            --text-primary: #323130;
            --text-secondary: #605e5c;
            --green: #107c10;
            --orange: #ff8c00;
            --red: #d13438;
            --blue: #0078d4;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--light);
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            font-size: 24px;
            color: var(--primary);
        }
        
        .title-group h1 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        
        .title-group .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        .actions {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .btn-outline {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .kpi-card {
            background: var(--surface);
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
            transition: transform 0.2s;
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
        }
        
        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .kpi-title {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .kpi-icon {
            font-size: 24px;
            opacity: 0.7;
        }
        
        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .kpi-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }
        
        .trend-up {
            color: var(--green);
        }
        
        .trend-down {
            color: var(--red);
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .chart-card {
            background: var(--surface);
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .chart-container {
            height: 320px;
            position: relative;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab:hover:not(.active) {
            color: var(--text-primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .data-table th {
            background: var(--light);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
        }
        
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .data-table tr:hover {
            background: var(--light);
        }
        
        .department-table tr.expandable {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .department-table tr.expandable:hover {
            background: rgba(0, 120, 212, 0.05);
        }
        
        .department-table tr.expandable td:first-child::before {
            content: '▶';
            margin-right: 8px;
            transition: transform 0.2s;
            display: inline-block;
        }
        
        .department-table tr.expandable.expanded td:first-child::before {
            transform: rotate(90deg);
        }
        
        .department-table tr.sub-department {
            background: rgba(0, 120, 212, 0.02);
            display: none;
        }
        
        .department-table tr.sub-department.show {
            display: table-row;
        }
        
        .department-table tr.sub-department td:first-child {
            padding-left: 40px;
            border-left: 3px solid var(--primary);
            position: relative;
        }
        
        .department-table tr.sub-department td:first-child::before {
            content: '└';
            position: absolute;
            left: 20px;
            color: var(--text-secondary);
        }
        
        .metric-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-excellent {
            background: rgba(16, 124, 16, 0.1);
            color: var(--green);
        }
        
        .badge-good {
            background: rgba(0, 120, 212, 0.1);
            color: var(--blue);
        }
        
        .badge-average {
            background: rgba(255, 140, 0, 0.1);
            color: var(--orange);
        }
        
        .badge-poor {
            background: rgba(209, 52, 56, 0.1);
            color: var(--red);
        }
        
        .hidden {
            display: none !important;
        }
        
        .chatbot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: var(--surface);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            z-index: 1000;
        }
        
        .chatbot.hidden {
            display: none !important;
        }
        
        .chatbot-header {
            padding: 16px;
            background: var(--primary);
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }
        
        .message {
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 12px;
            max-width: 80%;
        }
        
        .message.user {
            background: var(--primary);
            color: white;
            margin-left: auto;
        }
        
        .message.bot {
            background: var(--light);
            color: var(--text-primary);
        }
        
        .chatbot-input {
            padding: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 20px;
            outline: none;
        }
        
        .chatbot-input button {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-section">
            <div class="logo">📊</div>
            <div class="title-group">
                <h1>心动员工敬业度调研数据</h1>
                <div class="subtitle">2024年度分析报告</div>
            </div>
        </div>
        <div class="actions">
            <input type="file" id="excel-file" style="display: none;" accept=".xlsx,.xls" />
            <button class="btn btn-outline" onclick="document.getElementById('excel-file').click()">
                <span>📤</span> 上传数据
            </button>
            <button class="btn btn-primary" onclick="toggleChatbot()">
                <span>💬</span> 智能问答
            </button>
        </div>
    </div>

    <div class="container">
        <!-- KPI 仪表板 -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">总体人数</div>
                    <div class="kpi-icon">👥</div>
                </div>
                <div class="kpi-value">1,284</div>
                <div class="kpi-change">
                    <span>员工总数</span>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">填写人数</div>
                    <div class="kpi-icon">✅</div>
                </div>
                <div class="kpi-value">828</div>
                <div class="kpi-change">
                    <span class="trend-up">▲ 64.5%</span> 填写率
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">2024年敬业度</div>
                    <div class="kpi-icon">🔥</div>
                </div>
                <div class="kpi-value">68%</div>
                <div class="kpi-change">
                    <span class="trend-up">▲ +8%</span> vs 2023年
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">2024年满意度</div>
                    <div class="kpi-icon">😊</div>
                </div>
                <div class="kpi-value">68%</div>
                <div class="kpi-change">
                    <span class="trend-up">▲ +8%</span> vs 2023年
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">高效员工比例</div>
                    <div class="kpi-icon">⭐</div>
                </div>
                <div class="kpi-value">62.8%</div>
                <div class="kpi-change">
                    <span class="trend-up">▲ 敬业且满意</span>
                </div>
            </div>
        </div>

        <!-- 图表网格 -->
        <div class="charts-grid">
            <!-- 敬业度-满意度四象限图 -->
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">员工敬业-满意度交叉分析</div>
                </div>
                <div class="chart-container">
                    <canvas id="quadrantChart"></canvas>
                </div>
            </div>

            <!-- 年度对比图 -->
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">年度对比趋势</div>
                </div>
                <div class="chart-container">
                    <canvas id="yearly-trend"></canvas>
                </div>
            </div>
        </div>

        <!-- 标签页 -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('departments')">全部部门</button>
            <button class="tab" onclick="showTab('subdepartments')">二级部门</button>
            <button class="tab" onclick="showTab('management')">管理层对比</button>
            <button class="tab" onclick="showTab('levels')">职级分析</button>
        </div>

        <!-- 标签页内容 -->
        <div id="departments" class="tab-content active">
            <table class="data-table department-table">
                <thead>
                    <tr>
                        <th style="width: 40%;">部门</th>
                        <th style="width: 12%;">参与人数</th>
                        <th style="width: 16%;">敬业度</th>
                        <th style="width: 16%;">满意度</th>
                        <th style="width: 16%;">高效员工比例</th>
                    </tr>
                </thead>
                <tbody id="departmentTableBody">
                    <!-- 部门数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>

        <div id="subdepartments" class="tab-content">
            <table class="data-table department-table">
                <thead>
                    <tr>
                        <th style="width: 30%;">二级部门</th>
                        <th style="width: 20%;">所属一级部门</th>
                        <th style="width: 12%;">参与人数</th>
                        <th style="width: 13%;">敬业度</th>
                        <th style="width: 13%;">满意度</th>
                        <th style="width: 12%;">高效员工比例</th>
                    </tr>
                </thead>
                <tbody id="subDepartmentTableBody">
                    <!-- 二级部门数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>

        <div id="management" class="tab-content">
            <table class="data-table department-table">
                <thead>
                    <tr>
                        <th>管理岗位</th>
                        <th>填写人数</th>
                        <th>敬业度</th>
                        <th>满意度</th>
                        <th>敬业且满意比例</th>
                    </tr>
                </thead>
                <tbody id="managementTableBody">
                    <!-- 管理岗位数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>

        <div id="levels" class="tab-content">
            <table class="data-table department-table">
                <thead>
                    <tr>
                        <th>职级</th>
                        <th>填写人数</th>
                        <th>敬业度</th>
                        <th>满意度</th>
                        <th>敬业且满意比例</th>
                    </tr>
                </thead>
                <tbody id="levelsTableBody">
                    <!-- 职级数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- 聊天机器人 -->
    <div class="chatbot hidden" id="chatbot">
        <div class="chatbot-header">
            <span>💬 数据助手</span>
            <button class="chatbot-close" onclick="closeChatbot()">✕</button>
        </div>
        <div class="chatbot-messages" id="chat-messages">
            <div class="message bot">
                您好！我是员工敬业度调研数据助手。您可以询问：<br>
                • 哪个部门表现最好？<br>
                • 敬业度变化趋势如何？<br>
                • 满意度主要问题在哪里？
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chat-input" placeholder="输入您的问题..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()">发送</button>
        </div>
    </div>

    <script>
        // 全局数据存储
        let surveyData = {
            "填写率": [{"总体人数": 1284, "填写人数": 828, "填写率": 0.645, "对比去年": 0.145}],
            "结论概览": [{"24年敬业度": 0.68, "23年敬业度": 0.6, "24年满意度": 0.68, "23年满意度": 0.6}],
            "按管理岗位": [
                {"岗位类型": "管理岗位", "填写人数": 157, "敬业度": 0.764, "满意度": 0.783, "敬业且满意": 0.694},
                {"岗位类型": "非管理岗位", "填写人数": 671, "敬业度": 0.662, "满意度": 0.654, "敬业且满意": 0.613}
            ],
            "按职级": [
                {"职级类型": "3和4职级", "填写人数": 325, "敬业度": 0.708, "满意度": 0.705, "敬业且满意": 0.652},
                {"职级类型": "1和2职级", "填写人数": 503, "敬业度": 0.664, "满意度": 0.662, "敬业且满意": 0.612}
            ]
        };
        
        let departmentData = [
            // 一级部门数据
            {name: '财务部', count: 10, engagement: 40, satisfaction: 40, efficiency: 0},
            {name: '城北大王寨工作室', count: 172, engagement: 60, satisfaction: 61, efficiency: 55},
            {name: '法务部', count: 7, engagement: 71, satisfaction: 86, efficiency: 71},
            {name: '海外发行部', count: 3, engagement: 100, satisfaction: 100, efficiency: 100},
            {name: '极心社工作室', count: 59, engagement: 68, satisfaction: 66, efficiency: 64},
            {name: '技术支撑部', count: 62, engagement: 69, satisfaction: 66, efficiency: 61},
            {name: '美术支撑部', count: 46, engagement: 59, satisfaction: 59, efficiency: 52},
            {name: '平台支撑部', count: 20, engagement: 60, satisfaction: 65, efficiency: 55},
            {name: '浅水工作室', count: 12, engagement: 100, satisfaction: 100, efficiency: 100},
            {name: '人力资源部', count: 18, engagement: 61, satisfaction: 78, efficiency: 56},
            {name: '市场部', count: 30, engagement: 63, satisfaction: 60, efficiency: 57},
            {name: '项目管理部', count: 1, engagement: 100, satisfaction: 100, efficiency: 100},
            {name: '音频支撑部', count: 11, engagement: 45, satisfaction: 64, efficiency: 45},
            {name: '游戏菌工作室', count: 35, engagement: 66, satisfaction: 57, efficiency: 54},
            {name: '员工服务中心', count: 5, engagement: 100, satisfaction: 100, efficiency: 100},
            {name: '运维支撑部', count: 6, engagement: 100, satisfaction: 100, efficiency: 100},
            {name: '运营部', count: 47, engagement: 74, satisfaction: 72, efficiency: 68},
            {name: '政策关系与合规支持中心', count: 19, engagement: 89, satisfaction: 89, efficiency: 89},
            {name: '执行办公室', count: 4, engagement: 75, satisfaction: 100, efficiency: 75},
            {name: 'ADN', count: 7, engagement: 71, satisfaction: 71, efficiency: 71},
            {name: 'B格猫工作室', count: 60, engagement: 77, satisfaction: 72, efficiency: 68},
            {name: 'Digital & IT', count: 6, engagement: 67, satisfaction: 100, efficiency: 67},
            {name: 'Filo', count: 1, engagement: 100, satisfaction: 100, efficiency: 100},
            {name: 'Flash Party', count: 4, engagement: 75, satisfaction: 100, efficiency: 75},
            {name: 'PG 发行 & 商务部', count: 15, engagement: 73, satisfaction: 73, efficiency: 73},
            {name: 'TapTap', count: 168, engagement: 71, satisfaction: 69, efficiency: 66}
        ];

        // 基于CSV数据的二级部门数据
        const subDepartmentData = {
            '城北大王寨工作室': [
                {name: '海盗项目组', count: 60, engagement: 55, satisfaction: 60, efficiency: 50},
                {name: '横扫千军项目组', count: 2, engagement: 50, satisfaction: 50, efficiency: 50},
                {name: '其他', count: 2, engagement: 50, satisfaction: 50, efficiency: 50},
                {name: '伊瑟项目组（Etheria）', count: 53, engagement: 72, satisfaction: 66, efficiency: 62},
                {name: 'Meka项目组', count: 55, engagement: 56, satisfaction: 58, efficiency: 53}
            ],
            '极心社工作室': [
                {name: '策划', count: 21, engagement: 86, satisfaction: 81, efficiency: 81},
                {name: '技术', count: 9, engagement: 56, satisfaction: 56, efficiency: 56},
                {name: '美术', count: 24, engagement: 58, satisfaction: 58, efficiency: 54},
                {name: '其他', count: 5, engagement: 60, satisfaction: 60, efficiency: 60}
            ],
            'TapTap': [
                {name: 'Contents', count: 1, engagement: 100, satisfaction: 100, efficiency: 100},
                {name: 'Core Product & Services', count: 46, engagement: 65, satisfaction: 61, efficiency: 59},
                {name: 'Design Team', count: 10, engagement: 70, satisfaction: 60, efficiency: 60},
                {name: 'Developer Ops', count: 9, engagement: 89, satisfaction: 78, efficiency: 78},
                {name: 'Editors', count: 11, engagement: 91, satisfaction: 91, efficiency: 91},
                {name: 'IEM', count: 31, engagement: 74, satisfaction: 74, efficiency: 71},
                {name: 'International', count: 3, engagement: 0, satisfaction: 0, efficiency: 0},
                {name: 'Ops', count: 19, engagement: 84, satisfaction: 84, efficiency: 84},
                {name: 'Project SCE', count: 8, engagement: 63, satisfaction: 63, efficiency: 63},
                {name: 'Store', count: 11, engagement: 36, satisfaction: 55, efficiency: 36},
                {name: 'UG', count: 18, engagement: 83, satisfaction: 78, efficiency: 72}
            ]
        };

        let isAIResponding = false;

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            createCharts();
            generateDepartmentTable();
        });
        
        function loadDashboard() {
            // KPI数据已在HTML中硬编码，这里可以添加动态更新逻辑
        }
        
        function createCharts() {
            createQuadrantChart();
            createYearlyTrendChart();
        }
        
        function createQuadrantChart() {
            const ctx = document.getElementById('quadrantChart').getContext('2d');
            
            // 员工分类数据 - 根据图片中的数据
            const employeeData = [
                {
                    label: '高效员工 (敬业且满意)',
                    x: 78,  // 满意度
                    y: 78,  // 敬业度
                    r: 25,  // 62.8%对应的大圆
                    backgroundColor: 'rgba(40, 167, 69, 0.7)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    percentage: '62.8%'
                },
                {
                    label: '受挫员工 (敬业不满意)',
                    x: 25,  // 满意度
                    y: 75,  // 敬业度
                    r: 8,   // 5.3%对应的小圆
                    backgroundColor: 'rgba(255, 193, 7, 0.7)',
                    borderColor: 'rgba(255, 193, 7, 1)',
                    percentage: '5.3%'
                },
                {
                    label: '漠然员工 (不敬业但满意)',
                    x: 75,  // 满意度
                    y: 25,  // 敬业度
                    r: 8,   // 5.1%对应的小圆
                    backgroundColor: 'rgba(0, 123, 255, 0.7)',
                    borderColor: 'rgba(0, 123, 255, 1)',
                    percentage: '5.1%'
                },
                {
                    label: '低效员工 (不敬业不满意)',
                    x: 25,  // 满意度
                    y: 22,  // 敬业度
                    r: 15,  // 26.8%对应的中圆
                    backgroundColor: 'rgba(220, 53, 69, 0.7)',
                    borderColor: 'rgba(220, 53, 69, 1)',
                    percentage: '26.8%'
                }
            ];

            new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: employeeData.map(item => ({
                        label: item.label,
                        data: [{
                            x: item.x,
                            y: item.y,
                            r: item.r
                        }],
                        backgroundColor: item.backgroundColor,
                        borderColor: item.borderColor,
                        borderWidth: 2,
                        percentage: item.percentage
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                generateLabels: function(chart) {
                                    return employeeData.map((item, index) => ({
                                        text: `${item.label.split(' ')[0]} ${item.percentage}`,
                                        fillStyle: item.backgroundColor,
                                        strokeStyle: item.borderColor,
                                        lineWidth: 2,
                                        pointStyle: 'circle'
                                    }));
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function() {
                                    return '';
                                },
                                label: function(context) {
                                    const dataset = context.dataset;
                                    const dataPoint = context.parsed;
                                    return [
                                        `${dataset.label}`,
                                        `比例: ${dataset.percentage}`,
                                        `满意度: ${dataPoint.x}%`,
                                        `敬业度: ${dataPoint.y}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: '满意度 (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                stepSize: 25,
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: '敬业度 (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                stepSize: 25,
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false
                    }
                }
            });
        }
        
        function createYearlyTrendChart() {
            const ctx = document.getElementById('yearly-trend').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2023年', '2024年'],
                    datasets: [
                        {
                            label: '敬业度',
                            data: [60, 68],
                            borderColor: '#0078d4',
                            backgroundColor: 'rgba(0, 120, 212, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: '满意度',
                            data: [60, 68],
                            borderColor: '#107c10',
                            backgroundColor: 'rgba(16, 124, 16, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: value => value + '%' }
                        }
                    },
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
        }
        
        // 标签页切换
        function showTab(tabName) {
            // 隐藏所有标签页内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 移除所有标签页的活动状态
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 显示选中的标签页内容
            document.getElementById(tabName).classList.add('active');
            
            // 激活选中的标签页
            event.target.classList.add('active');
            
            // 根据标签页类型更新表格数据
            if (tabName === 'departments') {
                generateDepartmentTable();
            } else if (tabName === 'subdepartments') {
                generateSubDepartmentTable();
            } else if (tabName === 'management') {
                generateManagementTable();
            } else if (tabName === 'levels') {
                generateLevelsTable();
            }
        }

        function generateDepartmentTable() {
            const tbody = document.getElementById('departmentTableBody');
            tbody.innerHTML = '';
            
            departmentData.forEach((dept, index) => {
                // 一级部门行
                const row = document.createElement('tr');
                const hasSubDepts = subDepartmentData[dept.name] && subDepartmentData[dept.name].length > 0;
                
                if (hasSubDepts) {
                    row.className = 'expandable';
                    row.onclick = () => toggleSubDepartments(index);
                }
                
                row.innerHTML = `
                    <td><strong>${dept.name}</strong></td>
                    <td>${dept.count}</td>
                    <td>${getBadge(dept.engagement)}</td>
                    <td>${getBadge(dept.satisfaction)}</td>
                    <td>${getBadge(dept.efficiency)}</td>
                `;
                tbody.appendChild(row);
                
                // 二级部门行
                if (hasSubDepts) {
                    subDepartmentData[dept.name].forEach(subDept => {
                        const subRow = document.createElement('tr');
                        subRow.className = `sub-department sub-${index}`;
                        subRow.innerHTML = `
                            <td>${subDept.name}</td>
                            <td>${subDept.count}</td>
                            <td>${getBadge(subDept.engagement)}</td>
                            <td>${getBadge(subDept.satisfaction)}</td>
                            <td>${getBadge(subDept.efficiency)}</td>
                        `;
                        tbody.appendChild(subRow);
                    });
                }
            });
        }

        function toggleSubDepartments(index) {
            const parentRow = document.querySelector(`tr.expandable:nth-of-type(${index + 1})`);
            const subRows = document.querySelectorAll(`.sub-${index}`);
            
            if (parentRow.classList.contains('expanded')) {
                parentRow.classList.remove('expanded');
                subRows.forEach(row => row.classList.remove('show'));
            } else {
                parentRow.classList.add('expanded');
                subRows.forEach(row => row.classList.add('show'));
            }
        }

        function getBadge(value) {
            const percentage = Math.round(typeof value === 'number' ? value : value * 100);
            let badgeClass = 'badge-poor';
            
            if (percentage >= 80) badgeClass = 'badge-excellent';
            else if (percentage >= 60) badgeClass = 'badge-good';
            else if (percentage >= 40) badgeClass = 'badge-average';
            
            return `<span class="metric-badge ${badgeClass}">${percentage}%</span>`;
        }

        function generateSubDepartmentTable() {
            const tbody = document.getElementById('subDepartmentTableBody');
            tbody.innerHTML = '';
            
            departmentData.forEach((dept, index) => {
                if (subDepartmentData[dept.name]) {
                    subDepartmentData[dept.name].forEach((subDept, subIndex) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${subDept.name}</td>
                            <td>${dept.name}</td>
                            <td>${subDept.count}</td>
                            <td>${getBadge(subDept.engagement)}</td>
                            <td>${getBadge(subDept.satisfaction)}</td>
                            <td>${getBadge(subDept.efficiency)}</td>
                        `;
                        tbody.appendChild(row);
                    });
                }
            });
        }

        function generateManagementTable() {
            const tbody = document.getElementById('managementTableBody');
            tbody.innerHTML = '';
            
            const managementData = surveyData['按管理岗位'];
            managementData.forEach(dept => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dept.岗位类型}</td>
                    <td>${dept.填写人数}</td>
                    <td>${getBadge(dept.敬业度)}</td>
                    <td>${getBadge(dept.满意度)}</td>
                    <td>${getBadge(dept.敬业且满意)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function generateLevelsTable() {
            const tbody = document.getElementById('levelsTableBody');
            tbody.innerHTML = '';
            
            const levelsData = surveyData['按职级'];
            levelsData.forEach(dept => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dept.职级类型}</td>
                    <td>${dept.填写人数}</td>
                    <td>${getBadge(dept.敬业度)}</td>
                    <td>${getBadge(dept.满意度)}</td>
                    <td>${getBadge(dept.敬业且满意)}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function toggleChatbot() {
            const chatbot = document.getElementById('chatbot');
            chatbot.classList.toggle('hidden');
        }

        function closeChatbot() {
            const chatbot = document.getElementById('chatbot');
            chatbot.classList.add('hidden');
        }
        
        function sendMessage() {
            if (isAIResponding) return;
            
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            
            const messages = document.getElementById('chat-messages');
            
            // 添加用户消息
            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.textContent = message;
            messages.appendChild(userMsg);
            
            input.value = '';
            messages.scrollTop = messages.scrollHeight;
            
            // 显示AI思考状态
            isAIResponding = true;
            const thinkingMsg = document.createElement('div');
            thinkingMsg.className = 'message bot';
            thinkingMsg.innerHTML = 'AI正在思考<span class="typing-dots">...</span>';
            messages.appendChild(thinkingMsg);
            messages.scrollTop = messages.scrollHeight;
            
            // 生成智能回复
            setTimeout(() => {
                messages.removeChild(thinkingMsg);
                const botMsg = document.createElement('div');
                botMsg.className = 'message bot';
                botMsg.innerHTML = generateIntelligentResponse(message);
                messages.appendChild(botMsg);
                messages.scrollTop = messages.scrollHeight;
                isAIResponding = false;
            }, 1500);
        }
        
        function generateIntelligentResponse(message) {
            const msg = message.toLowerCase();
            
            // 部门相关问题
            if (msg.includes('部门') || msg.includes('表现') || msg.includes('最好') || msg.includes('最差')) {
                return `📊 <strong>部门表现分析：</strong><br><br>
                🏆 <strong>表现优秀的部门：</strong><br>
                • 浅水工作室、员工服务中心、运维支撑部：各项指标均达到100%<br>
                • 政策关系与合规支持中心：敬业度和满意度均为89%<br>
                • 法务部：满意度高达86%，敬业度71%<br><br>
                ⚠️ <strong>需要关注的部门：</strong><br>
                • 财务部：敬业度和满意度均为40%，高效员工比例为0%<br>
                • 音频支撑部：敬业度仅45%<br>
                • 美术支撑部：各项指标均在59%左右<br><br>
                💡 <strong>建议：</strong>向表现优秀的部门学习管理经验，重点改善财务部的工作环境和激励机制。`;
            }
            
            // 敬业度相关问题
            if (msg.includes('敬业度') || msg.includes('敬业')) {
                return `🔥 <strong>敬业度深度分析：</strong><br><br>
                📈 <strong>整体趋势：</strong>2024年敬业度68%，较2023年60%提升8个百分点<br><br>
                👥 <strong>人群对比：</strong><br>
                • 管理岗位：76.4%（优秀）<br>
                • 非管理岗位：66.2%（良好）<br>
                • 3-4职级：70.8%<br>
                • 1-2职级：66.4%<br><br>
                🎯 <strong>四象限分布：</strong><br>
                • 高效员工（敬业且满意）：62.8%<br>
                • 受挫员工（敬业但不满意）：5.3%<br>
                • 漠然员工（不敬业但满意）：5.1%<br>
                • 低效员工（不敬业不满意）：26.8%<br><br>
                💡 <strong>改进建议：</strong>重点关注26.8%的低效员工群体，分析其不敬业的根本原因。`;
            }
            
            // 满意度相关问题
            if (msg.includes('满意度') || msg.includes('满意')) {
                return `😊 <strong>满意度全面解析：</strong><br><br>
                📊 <strong>总体情况：</strong>2024年满意度68%，同比提升8个百分点<br><br>
                🏢 <strong>部门差异显著：</strong><br>
                • 最高：浅水工作室、员工服务中心等达100%<br>
                • 较高：执行办公室、Digital & IT、Flash Party达100%<br>
                • 需改善：财务部40%，游戏菌工作室57%<br><br>
                👔 <strong>岗位层级：</strong><br>
                • 管理岗位满意度：78.3%<br>
                • 非管理岗位满意度：65.4%<br><br>
                🔍 <strong>关键发现：</strong>管理层满意度明显高于基层员工，建议加强对基层员工的关怀和发展支持。`;
            }
            
            // 改进建议相关问题
            if (msg.includes('建议') || msg.includes('改进') || msg.includes('提升') || msg.includes('怎么办')) {
                return `💡 <strong>专业改进建议：</strong><br><br>
                🎯 <strong>短期行动（1-3个月）：</strong><br>
                • 重点关注财务部，开展一对一访谈了解具体问题<br>
                • 组织跨部门交流，让优秀部门分享管理经验<br>
                • 针对26.8%的低效员工群体制定个性化改进计划<br><br>
                📈 <strong>中期规划（3-6个月）：</strong><br>
                • 建立管理岗位与基层员工的定期沟通机制<br>
                • 完善非管理岗位的职业发展通道<br>
                • 加强对1-2职级员工的培训和发展支持<br><br>
                🏆 <strong>长期目标（6-12个月）：</strong><br>
                • 将高效员工比例从62.8%提升至75%以上<br>
                • 缩小部门间差距，确保所有部门敬业度不低于60%<br>
                • 建立可持续的员工敬业度提升机制`;
            }
            
            // 数据相关问题
            if (msg.includes('数据') || msg.includes('统计') || msg.includes('人数')) {
                return `📋 <strong>关键数据总览：</strong><br><br>
                👥 <strong>参与情况：</strong><br>
                • 员工总数：1,284人<br>
                • 填写人数：828人<br>
                • 填写率：64.5%（较去年提升14.5%）<br><br>
                📊 <strong>核心指标：</strong><br>
                • 2024年敬业度：68%（↑8% vs 2023）<br>
                • 2024年满意度：68%（↑8% vs 2023）<br>
                • 高效员工比例：62.8%<br><br>
                🏢 <strong>部门分布：</strong><br>
                • 最大部门：TapTap（168人）、城北大王寨工作室（172人）<br>
                • 管理岗位：157人<br>
                • 非管理岗位：671人<br><br>
                📈 <strong>趋势：</strong>各项指标均呈现积极向上趋势，员工整体状态良好。`;
            }
            
            // 默认回复
            return `🤖 <strong>智能分析助手</strong><br><br>
            感谢您的提问！我可以为您提供以下方面的专业分析：<br><br>
            📊 <strong>数据分析：</strong>部门表现、敬业度、满意度趋势<br>
            💡 <strong>改进建议：</strong>针对性的提升方案和行动计划<br>
            🔍 <strong>深度洞察：</strong>员工分类、管理层对比、职级分析<br><br>
            请告诉我您最关心的具体问题，我会为您提供详细的数据分析和专业建议！`;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !isAIResponding) {
                sendMessage();
            }
        }
    </script>
</body>
</html> 