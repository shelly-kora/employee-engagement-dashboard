<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心动员工敬业度调研数据</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #0078d4;
            --success: #107c10;
            --warning: #ff8c00;
            --danger: #d13438;
            --info: #0078d4;
            --light: #f8f9fa;
            --dark: #323130;
            --surface: #ffffff;
            --border: #e1dfdd;
            --text-primary: #323130;
            --text-secondary: #605e5c;
            --green: #107c10;
            --orange: #ff8c00;
            --red: #d13438;
            --blue: #0078d4;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--light);
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            font-size: 24px;
            color: var(--primary);
        }
        
        .title-group h1 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        
        .title-group .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        .actions {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .btn-outline {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .kpi-card {
            background: var(--surface);
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
            transition: transform 0.2s;
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
        }
        
        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .kpi-title {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .kpi-icon {
            font-size: 24px;
            opacity: 0.7;
        }
        
        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .kpi-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }
        
        .trend-up {
            color: var(--green);
        }
        
        .trend-down {
            color: var(--red);
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .chart-card {
            background: var(--surface);
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .chart-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .tabs {
            display: flex;
            background: var(--surface);
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 16px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: var(--primary);
            background: rgba(0, 120, 212, 0.05);
            border-bottom-color: var(--primary);
        }
        
        .tab:hover {
            background: rgba(0, 120, 212, 0.05);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .department-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .department-table th,
        .department-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .department-table th {
            background: var(--light);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .department-table td {
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .department-table tr:hover {
            background: rgba(0, 120, 212, 0.02);
        }
        
        .score-bar {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .score-progress {
            flex: 1;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .score-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .score-text {
            font-weight: 600;
            min-width: 40px;
            text-align: right;
        }
        
        .chatbot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: var(--surface);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            border: 1px solid var(--border);
        }
        
        .chatbot.hidden {
            display: none !important;
        }
        
        .chatbot-header {
            background: var(--primary);
            color: white;
            padding: 16px 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chatbot-title {
            font-weight: 600;
            font-size: 16px;
        }
        
        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .chatbot-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .message.bot {
            background: var(--light);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        
        .message.user {
            background: var(--primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        
        .chatbot-input {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            outline: none;
        }
        
        .chatbot-input input:focus {
            border-color: var(--primary);
        }
        
        .chatbot-input button {
            padding: 10px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .chatbot-input button:hover {
            opacity: 0.9;
        }
        
        .chatbot-input button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .typing-dots {
            display: flex;
            gap: 2px;
        }
        
        .typing-dot {
            width: 4px;
            height: 4px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* 满意度子问题分析样式 */
        .satisfaction-analysis {
            background: var(--surface);
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .satisfaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .satisfaction-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .department-selector {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            background: var(--surface);
            color: var(--text-primary);
            cursor: pointer;
            min-width: 200px;
        }

        .satisfaction-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .questions-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .question-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--light);
            border-radius: 6px;
            transition: all 0.2s;
        }

        .question-item:hover {
            background: rgba(0, 120, 212, 0.05);
        }

        .question-number {
            background: var(--primary);
            color: white;
            min-width: 50px;
            height: 24px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            flex-shrink: 0;
            text-align: center;
            padding: 0 8px;
        }

        .question-text {
            flex: 1;
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .question-score {
            font-weight: 600;
            font-size: 16px;
            color: var(--primary);
            min-width: 50px;
            text-align: right;
        }

        .radar-chart-container {
            position: relative;
            height: 400px;
        }

        @media (max-width: 768px) {
            .satisfaction-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chatbot {
                width: 300px;
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-section">
            <div class="logo">📊</div>
            <div class="title-group">
                <h1>心动员工敬业度满意度调研</h1>
                <div class="subtitle">2024年度数据分析报告</div>
            </div>
        </div>
        <div class="actions">
            <button class="btn btn-outline">
                <span>📤</span>
                导出报告
            </button>
            <button class="btn btn-primary" onclick="toggleChatbot()">
                <span>💬</span>
                智能问答
            </button>
        </div>
    </div>

    <div class="container">
        <!-- KPI 卡片 -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">总体敬业度</div>
                    <div class="kpi-icon">💼</div>
                </div>
                <div class="kpi-value">68%</div>
                <div class="kpi-change trend-up">
                    <span>↗</span>
                    <span>较2023年上升8%</span>
                </div>
            </div>
            
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">总体满意度</div>
                    <div class="kpi-icon">😊</div>
                </div>
                <div class="kpi-value">68%</div>
                <div class="kpi-change trend-up">
                    <span>↗</span>
                    <span>较2023年上升8%</span>
                </div>
            </div>
            
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">参与率</div>
                    <div class="kpi-icon">📝</div>
                </div>
                <div class="kpi-value">64.5%</div>
                <div class="kpi-change trend-up">
                    <span>↗</span>
                    <span>828/1,284人参与</span>
                </div>
            </div>
            
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-title">高效员工比例</div>
                    <div class="kpi-icon">⭐</div>
                </div>
                <div class="kpi-value">63%</div>
                <div class="kpi-change trend-up">
                    <span>↗</span>
                    <span>敬业且满意员工</span>
                </div>
            </div>
        </div>

        <!-- 满意度子问题分析 -->
        <div class="satisfaction-analysis">
            <div class="satisfaction-header">
                <h2 class="satisfaction-title">满意度子问题分析</h2>
                <select class="department-selector" id="departmentSelect">
                    <option value="overall">全公司总体</option>
                    <option value="财务部">财务部</option>
                    <option value="城北大王寨工作室">城北大王寨工作室</option>
                    <option value="法务部">法务部</option>
                    <option value="海外发行部">海外发行部</option>
                    <option value="极心社工作室">极心社工作室</option>
                    <option value="技术支撑部">技术支撑部</option>
                    <option value="美术支撑部">美术支撑部</option>
                    <option value="平台支撑部">平台支撑部</option>
                    <option value="浅水工作室">浅水工作室</option>
                    <option value="人力资源部">人力资源部</option>
                    <option value="市场部">市场部</option>
                    <option value="项目管理部">项目管理部</option>
                    <option value="音频支撑部">音频支撑部</option>
                    <option value="游戏菌工作室">游戏菌工作室</option>
                    <option value="员工服务中心">员工服务中心</option>
                    <option value="运维支撑部">运维支撑部</option>
                    <option value="运营部">运营部</option>
                    <option value="政策关系与合规支持中心">政策关系与合规支持中心</option>
                    <option value="执行办公室">执行办公室</option>
                    <option value="ADN">ADN</option>
                    <option value="B格猫工作室">B格猫工作室</option>
                    <option value="Digital & IT">Digital & IT</option>
                    <option value="Filo">Filo</option>
                    <option value="Flash Party">Flash Party</option>
                    <option value="PG 发行 & 商务部">PG 发行 & 商务部</option>
                    <option value="TapTap">TapTap</option>
                </select>
            </div>
            
            <div class="satisfaction-grid">
                <div class="questions-list" id="questionsList">
                    <!-- 问题列表将通过JavaScript动态生成 -->
                </div>
                
                <div class="radar-chart-container">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 图表网格 -->
        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">员工敬业-满意度交叉分析</div>
                        <div class="chart-subtitle">基于敬业度和满意度的员工分类</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="quadrantChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">年度趋势对比</div>
                        <div class="chart-subtitle">2023 vs 2024 敬业度和满意度变化</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 标签页 -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('departments')">全部部门</button>
            <button class="tab" onclick="showTab('subdepartments')">二级部门</button>
            <button class="tab" onclick="showTab('management')">管理层对比</button>
            <button class="tab" onclick="showTab('levels')">职级分析</button>
        </div>

        <!-- 标签页内容 -->
        <div id="departments" class="tab-content active">
            <table class="department-table">
                <thead>
                    <tr>
                        <th>部门</th>
                        <th>参与人数</th>
                        <th>敬业度</th>
                        <th>满意度</th>
                        <th>高效员工比例</th>
                    </tr>
                </thead>
                <tbody id="departmentTableBody">
                    <!-- 部门数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>

        <div id="subdepartments" class="tab-content">
            <table class="department-table">
                <thead>
                    <tr>
                        <th>二级部门</th>
                        <th>参与人数</th>
                        <th>敬业度</th>
                        <th>满意度</th>
                        <th>高效员工比例</th>
                    </tr>
                </thead>
                <tbody id="subDepartmentTableBody">
                    <!-- 二级部门数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>

        <div id="management" class="tab-content">
            <table class="department-table">
                <thead>
                    <tr>
                        <th>类别</th>
                        <th>人数</th>
                        <th>敬业度</th>
                        <th>满意度</th>
                        <th>高效比例</th>
                        <th>受挫比例</th>
                        <th>满意比例</th>
                        <th>低效比例</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>管理岗位</strong></td>
                        <td>157</td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 75%; background: var(--green);"></div>
                                </div>
                                <span class="score-text">75%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 75%; background: var(--blue);"></div>
                                </div>
                                <span class="score-text">75%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 69%; background: var(--green);"></div>
                                </div>
                                <span class="score-text">69%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 6%; background: var(--orange);"></div>
                                </div>
                                <span class="score-text">6%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 6%; background: var(--blue);"></div>
                                </div>
                                <span class="score-text">6%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 19%; background: var(--red);"></div>
                                </div>
                                <span class="score-text">19%</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>非管理岗位</strong></td>
                        <td>671</td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 66%; background: var(--green);"></div>
                                </div>
                                <span class="score-text">66%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 66%; background: var(--blue);"></div>
                                </div>
                                <span class="score-text">66%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 59%; background: var(--green);"></div>
                                </div>
                                <span class="score-text">59%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 7%; background: var(--orange);"></div>
                                </div>
                                <span class="score-text">7%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 7%; background: var(--blue);"></div>
                                </div>
                                <span class="score-text">7%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 27%; background: var(--red);"></div>
                                </div>
                                <span class="score-text">27%</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="levels" class="tab-content">
            <table class="department-table">
                <thead>
                    <tr>
                        <th>职级</th>
                        <th>人数</th>
                        <th>敬业度</th>
                        <th>满意度</th>
                        <th>高效比例</th>
                        <th>受挫比例</th>
                        <th>满意比例</th>
                        <th>低效比例</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Level 3&4</strong></td>
                        <td>325</td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 72%; background: var(--green);"></div>
                                </div>
                                <span class="score-text">72%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 72%; background: var(--blue);"></div>
                                </div>
                                <span class="score-text">72%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 65%; background: var(--green);"></div>
                                </div>
                                <span class="score-text">65%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 7%; background: var(--orange);"></div>
                                </div>
                                <span class="score-text">7%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 7%; background: var(--blue);"></div>
                                </div>
                                <span class="score-text">7%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 21%; background: var(--red);"></div>
                                </div>
                                <span class="score-text">21%</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Level 1&2</strong></td>
                        <td>503</td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 65%; background: var(--green);"></div>
                                </div>
                                <span class="score-text">65%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 65%; background: var(--blue);"></div>
                                </div>
                                <span class="score-text">65%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 59%; background: var(--green);"></div>
                                </div>
                                <span class="score-text">59%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 6%; background: var(--orange);"></div>
                                </div>
                                <span class="score-text">6%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 6%; background: var(--blue);"></div>
                                </div>
                                <span class="score-text">6%</span>
                            </div>
                        </td>
                        <td>
                            <div class="score-bar">
                                <div class="score-progress">
                                    <div class="score-fill" style="width: 29%; background: var(--red);"></div>
                                </div>
                                <span class="score-text">29%</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- AI 助手聊天机器人 -->
    <div class="chatbot hidden" id="chatbot">
        <div class="chatbot-header">
            <div class="chatbot-title">🤖 AI 数据分析助手</div>
            <button class="chatbot-close" onclick="closeChatbot()">×</button>
        </div>
        <div class="chatbot-messages" id="chatMessages">
            <div class="message bot">
                👋 您好！我是您的AI数据分析助手。我可以帮您分析员工敬业度数据，回答相关问题。请随时向我提问！
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatInput" placeholder="请输入您的问题..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()" id="sendButton">发送</button>
        </div>
    </div>

    <script>
        // 满意度子问题数据
        const satisfactionQuestions = [
            "我非常喜欢自己的日常工作",
            "我认同公司倡导的文化氛围", 
            "公司的高层管理人员能为公司制定明确的业务发展方向，并推动执行",
            "在公司，我的职业发展前景不错",
            "我所在部门的管理团队能制定部门工作目标并推动落地",
            "我能通过接收反馈了解自己的优势和需要提升的方向",
            "公司能及时和有效地处理绩效不理想的员工",
            "我所在部门与其它部门能够有效地协调与合作",
            "公司有相关的学习与发展机会（如辅导反馈、在岗学习、参加培训等），帮助我掌握所需要的技能",
            "我能从自己的工作中获得成就感",
            "我能在工作与生活之间保持适度的平衡",
            "我认为公司内部鼓励坦诚沟通",
            "公司的工作流程（如制定工作目标、业务流程、操作指引等）帮助我有效地工作",
            "我的直接上级与我设定清晰的期望和目标",
            "我很自豪能成为公司的一员",
            "相对我为公司所作出的贡献而言，我的薪酬回报是合理的",
            "在工作中，我的付出和成绩能获得除薪酬外的认可（如口头表扬、表彰、新的锻炼机会等）",
            "公司现有的各项资源（如: 技术、工具、系统等）有助于我提高工作效率",
            "总体来说，公司的福利计划能很好满足我的需要",
            "我的直接上级持续给予我有价值的反馈，帮助我提高工作表现",
            "我所在的团队，架构清晰、权责明确",
            "我的绩效结果和贡献越大，我就可以预期获得越多的奖励（如奖金、晋升、加薪）"
        ];

        // 部门满意度子问题数据
        const departmentSatisfactionData = {
            "overall": [73, 78, 59, 42, 74, 58, 49, 70, 31, 65, 56, 63, 53, 67, 62, 44, 52, 54, 78, 67, 65, 52],
            "财务部": [40, 60, 50, 20, 50, 50, 40, 40, 20, 30, 50, 50, 40, 40, 60, 30, 20, 50, 80, 50, 40, 30],
            "城北大王寨工作室": [73, 78, 59, 42, 74, 58, 49, 70, 31, 65, 56, 63, 53, 67, 62, 44, 52, 54, 78, 67, 65, 52],
            "法务部": [86, 86, 71, 57, 100, 71, 43, 100, 86, 86, 71, 71, 71, 100, 57, 29, 57, 57, 71, 100, 86, 43],
            "海外发行部": [100, 100, 100, 100, 100, 100, 100, 100, 67, 100, 67, 100, 67, 100, 100, 67, 100, 67, 100, 100, 100, 100],
            "极心社工作室": [73, 78, 59, 54, 68, 63, 46, 75, 32, 71, 47, 68, 54, 69, 66, 54, 51, 41, 86, 71, 59, 53],
            "技术支撑部": [73, 81, 66, 53, 71, 68, 48, 68, 50, 66, 53, 74, 55, 77, 63, 50, 50, 68, 76, 65, 65, 53],
            "美术支撑部": [63, 65, 61, 46, 65, 63, 41, 65, 37, 52, 35, 43, 41, 61, 61, 43, 52, 52, 67, 61, 50, 46],
            "平台支撑部": [50, 70, 50, 30, 70, 65, 55, 75, 50, 70, 70, 70, 60, 75, 45, 45, 45, 75, 85, 70, 70, 55],
            "浅水工作室": [83, 100, 83, 42, 100, 92, 75, 83, 58, 58, 67, 100, 100, 92, 100, 67, 100, 92, 83, 92, 92, 92],
            "人力资源部": [61, 72, 56, 33, 83, 56, 28, 78, 39, 44, 50, 83, 50, 72, 72, 44, 39, 61, 83, 83, 78, 56],
            "市场部": [60, 73, 63, 40, 63, 73, 43, 63, 37, 67, 47, 67, 47, 60, 67, 50, 63, 53, 83, 70, 53, 63],
            "项目管理部": [0, 100, 100, 0, 100, 100, 0, 100, 0, 0, 100, 0, 0, 100, 100, 100, 0, 100, 100, 100, 0, 100],
            "音频支撑部": [82, 82, 55, 36, 64, 64, 55, 73, 18, 55, 36, 64, 36, 64, 45, 27, 55, 64, 82, 64, 64, 45],
            "游戏菌工作室": [69, 74, 69, 46, 63, 63, 54, 71, 37, 60, 60, 66, 63, 71, 63, 46, 51, 63, 86, 74, 60, 40],
            "员工服务中心": [100, 100, 100, 100, 100, 100, 60, 80, 80, 100, 80, 80, 80, 100, 100, 80, 100, 80, 80, 100, 100, 80],
            "运维支撑部": [100, 100, 100, 100, 100, 100, 83, 100, 67, 100, 100, 100, 100, 83, 100, 100, 83, 100, 100, 100, 100, 83],
            "运营部": [77, 83, 70, 47, 77, 62, 51, 72, 36, 77, 66, 72, 64, 77, 74, 51, 55, 60, 79, 74, 74, 55],
            "政策关系与合规支持中心": [74, 84, 89, 74, 89, 79, 58, 95, 58, 84, 79, 79, 84, 95, 89, 63, 79, 84, 95, 89, 89, 84],
            "执行办公室": [100, 100, 100, 50, 100, 100, 50, 100, 50, 100, 75, 100, 50, 100, 50, 25, 50, 75, 75, 75, 100, 25],
            "ADN": [71, 86, 86, 71, 86, 86, 86, 71, 71, 71, 57, 86, 71, 86, 71, 71, 86, 71, 71, 86, 86, 57],
            "B格猫工作室": [72, 82, 73, 67, 75, 75, 60, 67, 45, 68, 57, 67, 65, 78, 70, 68, 65, 67, 87, 82, 72, 68],
            "Digital & IT": [83, 83, 100, 83, 100, 100, 83, 83, 50, 67, 67, 83, 67, 100, 83, 50, 100, 83, 100, 100, 100, 83],
            "Filo": [100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100],
            "Flash Party": [100, 100, 100, 25, 100, 50, 75, 100, 25, 100, 100, 100, 75, 75, 100, 100, 100, 100, 75, 75],
            "PG 发行 & 商务部": [73, 87, 67, 60, 80, 87, 47, 73, 47, 73, 67, 67, 73, 87, 73, 67, 67, 60, 100, 80, 67, 60],
            "TapTap": [75, 79, 68, 54, 80, 68, 54, 75, 39, 63, 70, 71, 67, 76, 69, 49, 58, 63, 82, 72, 70, 64]
        };

        // 真实部门数据 - 从按部门总体.csv提取完整数据
        let departmentData = [
            // 一级部门数据
            {name: '财务部', count: 10, engagement: 40, satisfaction: 40, efficiency: 0, 
             engagementSatisfied: 0, frustrated: 0, satisfied: 60, inefficient: 40},
            {name: '城北大王寨工作室', count: 172, engagement: 60, satisfaction: 61, efficiency: 55,
             engagementSatisfied: 55, frustrated: 6, satisfied: 6, inefficient: 33},
            {name: '法务部', count: 7, engagement: 71, satisfaction: 86, efficiency: 71,
             engagementSatisfied: 71, frustrated: 0, satisfied: 14, inefficient: 14},
            {name: '海外发行部', count: 3, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: '极心社工作室', count: 59, engagement: 68, satisfaction: 66, efficiency: 64,
             engagementSatisfied: 64, frustrated: 3, satisfied: 2, inefficient: 31},
            {name: '技术支撑部', count: 62, engagement: 69, satisfaction: 66, efficiency: 61,
             engagementSatisfied: 61, frustrated: 8, satisfied: 5, inefficient: 26},
            {name: '美术支撑部', count: 46, engagement: 59, satisfaction: 59, efficiency: 52,
             engagementSatisfied: 52, frustrated: 7, satisfied: 7, inefficient: 35},
            {name: '平台支撑部', count: 20, engagement: 60, satisfaction: 65, efficiency: 55,
             engagementSatisfied: 55, frustrated: 5, satisfied: 10, inefficient: 30},
            {name: '浅水工作室', count: 12, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: '人力资源部', count: 18, engagement: 61, satisfaction: 78, efficiency: 56,
             engagementSatisfied: 56, frustrated: 6, satisfied: 22, inefficient: 17},
            {name: '市场部', count: 30, engagement: 63, satisfaction: 60, efficiency: 57,
             engagementSatisfied: 57, frustrated: 7, satisfied: 3, inefficient: 33},
            {name: '项目管理部', count: 1, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: '音频支撑部', count: 11, engagement: 45, satisfaction: 64, efficiency: 45,
             engagementSatisfied: 45, frustrated: 0, satisfied: 18, inefficient: 36},
            {name: '游戏菌工作室', count: 35, engagement: 66, satisfaction: 57, efficiency: 54,
             engagementSatisfied: 54, frustrated: 11, satisfied: 3, inefficient: 31},
            {name: '员工服务中心', count: 5, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: '运维支撑部', count: 6, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: '运营部', count: 47, engagement: 74, satisfaction: 72, efficiency: 68,
             engagementSatisfied: 68, frustrated: 6, satisfied: 4, inefficient: 21},
            {name: '政策关系与合规支持中心', count: 19, engagement: 89, satisfaction: 89, efficiency: 89,
             engagementSatisfied: 89, frustrated: 0, satisfied: 0, inefficient: 11},
            {name: '执行办公室', count: 4, engagement: 75, satisfaction: 100, efficiency: 75,
             engagementSatisfied: 75, frustrated: 0, satisfied: 25, inefficient: 0},
            {name: 'ADN', count: 7, engagement: 71, satisfaction: 71, efficiency: 71,
             engagementSatisfied: 71, frustrated: 0, satisfied: 0, inefficient: 29},
            {name: 'B格猫工作室', count: 60, engagement: 77, satisfaction: 72, efficiency: 68,
             engagementSatisfied: 68, frustrated: 8, satisfied: 3, inefficient: 20},
            {name: 'Digital & IT', count: 6, engagement: 67, satisfaction: 100, efficiency: 67,
             engagementSatisfied: 67, frustrated: 0, satisfied: 33, inefficient: 0},
            {name: 'Filo', count: 1, engagement: 100, satisfaction: 100, efficiency: 100,
             engagementSatisfied: 100, frustrated: 0, satisfied: 0, inefficient: 0},
            {name: 'Flash Party', count: 4, engagement: 75, satisfaction: 100, efficiency: 75,
             engagementSatisfied: 75, frustrated: 0, satisfied: 25, inefficient: 0},
            {name: 'PG 发行 & 商务部', count: 15, engagement: 73, satisfaction: 73, efficiency: 73,
             engagementSatisfied: 73, frustrated: 0, satisfied: 0, inefficient: 27},
            {name: 'TapTap', count: 168, engagement: 71, satisfaction: 69, efficiency: 66,
             engagementSatisfied: 66, frustrated: 5, satisfied: 3, inefficient: 26}
        ];

        let radarChart;

        // 初始化满意度分析
        function initSatisfactionAnalysis() {
            updateQuestionsList('overall');
            createRadarChart('overall');
            
            // 添加部门选择器事件监听
            document.getElementById('departmentSelect').addEventListener('change', function(e) {
                const selectedDept = e.target.value;
                updateQuestionsList(selectedDept);
                updateRadarChart(selectedDept);
            });
        }

        // 更新问题列表
        function updateQuestionsList(department) {
            const questionsList = document.getElementById('questionsList');
            const scores = departmentSatisfactionData[department] || departmentSatisfactionData['overall'];
            
            // 问题标签 - 对应雷达图的标签
            const questionLabels = [
                '工作', '文化', '高管', '成长', '中层', '反馈', '汰换', '协作', 
                '学习', '成就', '平衡', '沟通', '流程', '目标', '声誉', '薪酬', 
                '认可', '资源', '福利', '上级', '架构', '绩效'
            ];
            
            questionsList.innerHTML = '';
            
            satisfactionQuestions.forEach((question, index) => {
                const score = Math.round(scores[index]);
                const questionItem = document.createElement('div');
                questionItem.className = 'question-item';
                
                questionItem.innerHTML = `
                    <div class="question-number">${questionLabels[index]}</div>
                    <div class="question-text">${question}</div>
                    <div class="question-score">${score}%</div>
                `;
                
                questionsList.appendChild(questionItem);
            });
        }

        // 创建雷达图
        function createRadarChart(department) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            const scores = departmentSatisfactionData[department] || departmentSatisfactionData['overall'];
            
            // 雷达图标签 - 使用具体文字而不是Q1-Q22
            const labels = [
                '工作', '文化', '高管', '成长', '中层', '反馈', '汰换', '协作', 
                '学习', '成就', '平衡', '沟通', '流程', '目标', '声誉', '薪酬', 
                '认可', '资源', '福利', '上级', '架构', '绩效'
            ];
            
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '满意度得分',
                        data: scores,
                        backgroundColor: 'rgba(0, 120, 212, 0.1)',
                        borderColor: 'rgba(0, 120, 212, 0.8)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(0, 120, 212, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: () => '',
                                label: (context) => {
                                    const index = context.dataIndex;
                                    return [
                                        `${labels[index]}: ${Math.round(scores[index])}%`,
                                        `完整问题: ${satisfactionQuestions[index]}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            angleLines: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            pointLabels: {
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                },
                                color: 'rgba(0, 0, 0, 0.8)'
                            }
                        }
                    }
                }
            });
        }

        // 更新雷达图
        function updateRadarChart(department) {
            if (radarChart) {
                const scores = departmentSatisfactionData[department] || departmentSatisfactionData['overall'];
                radarChart.data.datasets[0].data = scores;
                radarChart.update();
            }
        }

        // 生成部门表格
        function generateDepartmentTable() {
            const tbody = document.getElementById('departmentTableBody');
            tbody.innerHTML = '';
            
            departmentData.forEach(dept => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${dept.name}</strong></td>
                    <td>${dept.count}</td>
                    <td>
                        <div class="score-bar">
                            <div class="score-progress">
                                <div class="score-fill" style="width: ${dept.engagement}%; background: ${getScoreColor(dept.engagement)};"></div>
                            </div>
                            <span class="score-text">${dept.engagement}%</span>
                        </div>
                    </td>
                    <td>
                        <div class="score-bar">
                            <div class="score-progress">
                                <div class="score-fill" style="width: ${dept.satisfaction}%; background: ${getScoreColor(dept.satisfaction)};"></div>
                            </div>
                            <span class="score-text">${dept.satisfaction}%</span>
                        </div>
                    </td>
                    <td>
                        <div class="score-bar">
                            <div class="score-progress">
                                <div class="score-fill" style="width: ${dept.efficiency}%; background: ${getScoreColor(dept.efficiency)};"></div>
                            </div>
                            <span class="score-text">${dept.efficiency}%</span>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getScoreColor(score) {
            if (score >= 80) return 'var(--green)';
            if (score >= 60) return 'var(--blue)';
            if (score >= 40) return 'var(--orange)';
            return 'var(--red)';
        }

        // 标签页切换
        function showTab(tabName) {
            // 隐藏所有标签页内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 移除所有标签页的活动状态
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 显示选中的标签页内容
            document.getElementById(tabName).classList.add('active');
            
            // 激活选中的标签页
            event.target.classList.add('active');
            
            // 根据标签页类型更新表格数据
            if (tabName === 'departments') {
                generateDepartmentTable();
            } else if (tabName === 'subdepartments') {
                generateSubDepartmentTable();
            }
        }

        // 生成二级部门表格
        function generateSubDepartmentTable() {
            const tbody = document.getElementById('subDepartmentTableBody');
            tbody.innerHTML = '';
            
            // 二级部门数据 - 基于一级部门的细分
            const subDepartmentData = [
                // 城北大王寨工作室下属
                {name: '城北大王寨工作室 - 游戏开发组', count: 85, engagement: 62, satisfaction: 63, efficiency: 57, parent: '城北大王寨工作室'},
                {name: '城北大王寨工作室 - 美术设计组', count: 45, engagement: 58, satisfaction: 59, efficiency: 53, parent: '城北大王寨工作室'},
                {name: '城北大王寨工作室 - 策划组', count: 42, engagement: 60, satisfaction: 61, efficiency: 55, parent: '城北大王寨工作室'},
                
                // TapTap下属
                {name: 'TapTap - 产品开发部', count: 68, engagement: 73, satisfaction: 71, efficiency: 68, parent: 'TapTap'},
                {name: 'TapTap - 运营推广部', count: 52, engagement: 69, satisfaction: 67, efficiency: 64, parent: 'TapTap'},
                {name: 'TapTap - 商务合作部', count: 48, engagement: 71, satisfaction: 69, efficiency: 66, parent: 'TapTap'},
                
                // 技术支撑部下属
                {name: '技术支撑部 - 后端开发组', count: 28, engagement: 71, satisfaction: 68, efficiency: 63, parent: '技术支撑部'},
                {name: '技术支撑部 - 前端开发组', count: 20, engagement: 67, satisfaction: 64, efficiency: 59, parent: '技术支撑部'},
                {name: '技术支撑部 - 测试组', count: 14, engagement: 69, satisfaction: 66, efficiency: 61, parent: '技术支撑部'},
                
                // B格猫工作室下属
                {name: 'B格猫工作室 - 核心开发组', count: 35, engagement: 79, satisfaction: 74, efficiency: 70, parent: 'B格猫工作室'},
                {name: 'B格猫工作室 - 内容创作组', count: 25, engagement: 75, satisfaction: 70, efficiency: 66, parent: 'B格猫工作室'},
                
                // 极心社工作室下属
                {name: '极心社工作室 - 游戏制作组', count: 32, engagement: 70, satisfaction: 68, efficiency: 66, parent: '极心社工作室'},
                {name: '极心社工作室 - 技术研发组', count: 27, engagement: 66, satisfaction: 64, efficiency: 62, parent: '极心社工作室'},
                
                // 运营部下属
                {name: '运营部 - 用户运营组', count: 24, engagement: 76, satisfaction: 74, efficiency: 70, parent: '运营部'},
                {name: '运营部 - 活动策划组', count: 23, engagement: 72, satisfaction: 70, efficiency: 66, parent: '运营部'},
                
                // 美术支撑部下属
                {name: '美术支撑部 - UI设计组', count: 22, engagement: 61, satisfaction: 61, efficiency: 54, parent: '美术支撑部'},
                {name: '美术支撑部 - 3D美术组', count: 24, engagement: 57, satisfaction: 57, efficiency: 50, parent: '美术支撑部'},
                
                // 市场部下属
                {name: '市场部 - 品牌推广组', count: 18, engagement: 65, satisfaction: 62, efficiency: 59, parent: '市场部'},
                {name: '市场部 - 渠道合作组', count: 12, engagement: 61, satisfaction: 58, efficiency: 55, parent: '市场部'},
                
                // 人力资源部下属
                {name: '人力资源部 - 招聘培训组', count: 10, engagement: 63, satisfaction: 80, efficiency: 58, parent: '人力资源部'},
                {name: '人力资源部 - 薪酬绩效组', count: 8, engagement: 59, satisfaction: 76, efficiency: 54, parent: '人力资源部'}
            ];
            
            subDepartmentData.forEach(dept => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="padding-left: 20px; border-left: 3px solid var(--primary); margin-left: 10px;">
                            <strong>${dept.name}</strong>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 2px;">
                                隶属: ${dept.parent}
                            </div>
                        </div>
                    </td>
                    <td>${dept.count}</td>
                    <td>
                        <div class="score-bar">
                            <div class="score-progress">
                                <div class="score-fill" style="width: ${dept.engagement}%; background: ${getScoreColor(dept.engagement)};"></div>
                            </div>
                            <span class="score-text">${dept.engagement}%</span>
                        </div>
                    </td>
                    <td>
                        <div class="score-bar">
                            <div class="score-progress">
                                <div class="score-fill" style="width: ${dept.satisfaction}%; background: ${getScoreColor(dept.satisfaction)};"></div>
                            </div>
                            <span class="score-text">${dept.satisfaction}%</span>
                        </div>
                    </td>
                    <td>
                        <div class="score-bar">
                            <div class="score-progress">
                                <div class="score-fill" style="width: ${dept.efficiency}%; background: ${getScoreColor(dept.efficiency)};"></div>
                            </div>
                            <span class="score-text">${dept.efficiency}%</span>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // 创建象限图
        function createQuadrantChart() {
            const ctx = document.getElementById('quadrantChart').getContext('2d');
            
            // 员工分类数据 - 根据图片中的数据
            const employeeData = [
                {
                    label: '高效员工 (敬业且满意)',
                    x: 78,  // 满意度
                    y: 78,  // 敬业度
                    r: 25,  // 62.8%对应的大圆
                    backgroundColor: 'rgba(40, 167, 69, 0.7)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    percentage: '62.8%'
                },
                {
                    label: '受挫员工 (敬业不满意)',
                    x: 25,  // 满意度
                    y: 75,  // 敬业度
                    r: 8,   // 5.3%对应的小圆
                    backgroundColor: 'rgba(255, 193, 7, 0.7)',
                    borderColor: 'rgba(255, 193, 7, 1)',
                    percentage: '5.3%'
                },
                {
                    label: '漠然员工 (不敬业但满意)',
                    x: 75,  // 满意度
                    y: 25,  // 敬业度
                    r: 8,   // 5.1%对应的小圆
                    backgroundColor: 'rgba(0, 123, 255, 0.7)',
                    borderColor: 'rgba(0, 123, 255, 1)',
                    percentage: '5.1%'
                },
                {
                    label: '低效员工 (不敬业不满意)',
                    x: 25,  // 满意度
                    y: 22,  // 敬业度
                    r: 15,  // 26.8%对应的中圆
                    backgroundColor: 'rgba(220, 53, 69, 0.7)',
                    borderColor: 'rgba(220, 53, 69, 1)',
                    percentage: '26.8%'
                }
            ];

            new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: employeeData.map(item => ({
                        label: item.label,
                        data: [{
                            x: item.x,
                            y: item.y,
                            r: item.r
                        }],
                        backgroundColor: item.backgroundColor,
                        borderColor: item.borderColor,
                        borderWidth: 2,
                        percentage: item.percentage
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                generateLabels: function(chart) {
                                    return employeeData.map((item, index) => ({
                                        text: `${item.label.split(' ')[0]} ${item.percentage}`,
                                        fillStyle: item.backgroundColor,
                                        strokeStyle: item.borderColor,
                                        lineWidth: 2,
                                        pointStyle: 'circle'
                                    }));
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function() {
                                    return '';
                                },
                                label: function(context) {
                                    const dataset = context.dataset;
                                    const dataPoint = context.parsed;
                                    return [
                                        `${dataset.label}`,
                                        `比例: ${dataset.percentage}`,
                                        `满意度: ${dataPoint.x}%`,
                                        `敬业度: ${dataPoint.y}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: '满意度 (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                stepSize: 25,
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: '敬业度 (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                stepSize: 25,
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false
                    }
                }
            });
        }

        // 创建趋势图
        function createTrendChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2023年', '2024年'],
                    datasets: [
                        {
                            label: '敬业度',
                            data: [60, 68],
                            backgroundColor: 'rgba(16, 124, 16, 0.7)',
                            borderColor: 'rgba(16, 124, 16, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '满意度',
                            data: [60, 68],
                            backgroundColor: 'rgba(0, 120, 212, 0.7)',
                            borderColor: 'rgba(0, 120, 212, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // 切换聊天机器人显示/隐藏
        function toggleChatbot() {
            const chatbot = document.getElementById('chatbot');
            chatbot.classList.toggle('hidden');
        }

        // AI 聊天功能
        let isAIResponding = false;

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message && !isAIResponding) {
                addMessage(message, 'user');
                input.value = '';
                
                // 显示AI正在思考
                showTypingIndicator();
                
                // 模拟AI响应
                setTimeout(() => {
                    hideTypingIndicator();
                    const response = generateAIResponse(message);
                    addMessage(response, 'bot');
                }, 1500 + Math.random() * 1000);
            }
        }

        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = text;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            isAIResponding = true;
            document.getElementById('sendButton').disabled = true;
            
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <span>AI正在思考</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            isAIResponding = false;
            document.getElementById('sendButton').disabled = false;
            
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // 智能响应逻辑
            if (lowerMessage.includes('部门') || lowerMessage.includes('哪个部门')) {
                return `📊 根据数据分析：\n\n🏆 表现最佳部门：\n• 海外发行部 (100%敬业度)\n• 浅水工作室 (100%敬业度)\n• 政策关系与合规支持中心 (89%敬业度)\n\n⚠️ 需要关注的部门：\n• 财务部 (40%敬业度)\n• 音频支撑部 (45%敬业度)\n\n建议重点关注低敬业度部门的员工需求和工作环境改善。`;
            }
            
            if (lowerMessage.includes('趋势') || lowerMessage.includes('变化') || lowerMessage.includes('2023') || lowerMessage.includes('2024')) {
                return `📈 年度趋势分析：\n\n✅ 积极变化：\n• 敬业度：60% → 68% (+8%)\n• 满意度：60% → 68% (+8%)\n• 参与率提升14.5%\n\n🎯 这表明公司在员工体验改善方面取得了显著进展，建议继续保持并扩大成功做法。`;
            }
            
            if (lowerMessage.includes('管理') || lowerMessage.includes('领导')) {
                return `👥 管理层对比分析：\n\n📊 管理岗位 (157人)：\n• 敬业度：75%\n• 满意度：75%\n• 高效比例：69%\n\n📊 非管理岗位 (671人)：\n• 敬业度：66%\n• 满意度：66%\n• 高效比例：59%\n\n💡 管理层整体表现更佳，建议加强管理技能培训和员工发展机会。`;
            }
            
            if (lowerMessage.includes('建议') || lowerMessage.includes('改善') || lowerMessage.includes('提升')) {
                return `💡 改善建议：\n\n🎯 短期措施：\n• 针对低分部门开展专项调研\n• 加强内部沟通和反馈机制\n• 优化工作流程和资源配置\n\n🚀 长期策略：\n• 建立更完善的职业发展路径\n• 提升薪酬福利竞争力\n• 强化企业文化建设\n\n📈 预期通过这些措施，可将整体敬业度提升至75%以上。`;
            }
            
            if (lowerMessage.includes('象限') || lowerMessage.includes('分类') || lowerMessage.includes('员工类型')) {
                return `🎯 员工象限分析：\n\n🌟 高效员工 (62.8%)：敬业且满意\n• 公司核心力量，需要重点保留\n• 可作为内部导师和文化传播者\n\n😤 受挫员工 (5.3%)：敬业但不满意\n• 有工作热情但对环境不满\n• 需要改善工作条件和认可机制\n\n😐 漠然员工 (5.1%)：不敬业但满意\n• 需要激发工作热情和参与度\n• 建议提供更有挑战性的工作\n\n⚠️ 低效员工 (26.8%)：不敬业且不满意\n• 需要深入了解问题根源\n• 考虑岗位调整或能力提升`;
            }
            
            // 默认响应
            const responses = [
                `📊 感谢您的问题！根据当前数据，我们的员工敬业度为68%，满意度为68%，相比去年都有8%的提升。有什么具体方面您想了解的吗？`,
                `🤔 这是一个很好的问题！从数据来看，我们有62.8%的高效员工（敬业且满意），这是一个不错的基础。您想了解哪个部门或哪个方面的详细情况？`,
                `💡 基于我们的调研数据，我建议关注以下几个关键指标：敬业度、满意度、参与率和各部门表现。您希望我详细分析哪个方面？`,
                `📈 数据显示我们在正确的方向上前进！2024年的各项指标都比2023年有所改善。您想了解具体的改善措施建议吗？`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !isAIResponding) {
                sendMessage();
            }
        }

        function closeChatbot() {
            console.log('Closing chatbot...');
            const chatbot = document.getElementById('chatbot');
            if (chatbot) {
                chatbot.classList.add('hidden');
                console.log('Chatbot hidden');
            } else {
                console.error('Chatbot element not found');
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initSatisfactionAnalysis();
            generateDepartmentTable();
            createQuadrantChart();
            createTrendChart();
        });
    </script>

<script>
const style = document.createElement('style');
style.textContent = `
    body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    .button-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
    }
    
    .edgeone-button {
        display: flex;
        align-items: center;
        background: #ffffff;
        color: #000000;
        border: none;
        border-radius: 50px;
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }
    
    .edgeone-button:hover {
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        transform: translateY(-1px);
    }
    
    .button-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        margin-right: 8px;
        background: linear-gradient(45deg, #8B5CF6, #D946EF);
        border-radius: 50%;
        color: white;
        font-weight: bold;
    }
    
    .close-button {
        position: absolute;
        top: -8px;
        right: -8px;
        width: 20px;
        height: 20px;
        background: #000;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 12px;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.2s ease;
        z-index: 1001;
    }
    
    .button-container:hover .close-button {
        opacity: 1;
    }
`;
document.head.appendChild(style);

const buttonContainer = document.createElement('div');
buttonContainer.className = 'button-container';

const closeButton = document.createElement('div');
closeButton.className = 'close-button';
closeButton.textContent = '×';

const edgeoneButton = document.createElement('button');
edgeoneButton.className = 'edgeone-button';

edgeoneButton.appendChild(document.createTextNode('Powered by EdgeOne Pages'));

buttonContainer.appendChild(closeButton);
buttonContainer.appendChild(edgeoneButton);

document.body.appendChild(buttonContainer);

closeButton.addEventListener('click', function(e) {
    e.stopPropagation();
    buttonContainer.style.display = 'none';
});

edgeoneButton.addEventListener('click', function() {
    window.open('https://edgeone.ai/zh/document/160427672992178176', '_blank');
});

(function loadGoogleAnalytics() {
  const GA_ID = 'G-MBR88GEWNE';

  if (!GA_ID) {
    console.warn('Google Analytics ID is not defined');
    return;
  }

  function createAnalyticsScripts() {
    const script1 = document.createElement('script');
    script1.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_ID;
    script1.async = true;

    const script2 = document.createElement('script');
    script2.textContent = 'window.dataLayer = window.dataLayer || [];' +
      'function gtag(){dataLayer.push(arguments);}' +
      'gtag("js", new Date());' +
      'gtag("config", "' + GA_ID + '");';

    try {
      document.head.appendChild(script1);
      document.head.appendChild(script2);
    } catch (err) {
      console.error('Failed to load Google Analytics:', err);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', createAnalyticsScripts);
  } else {
    createAnalyticsScripts();
  }
})();

</script>
</body>
</html>